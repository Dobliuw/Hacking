-----
- Tags: #teoria #practica 
-----
# Openssl

**Openssl** es una herramienta que proporciona funcionalidades relacionadas con la seguridad de la comunicación y la criptografía. A su vez ofrece una serie de características y funciones para la administraciń de claves, la creación de certificados, la generación de cifrados y hashes, y mucho más.
-----
# Cifrado y Descifrado 

**Openssl** permite cifrar y descrifrar datos utilizando diversos algoritmos de cifrado simétrico y asimétrico. Teniendo en cuenta esto, es posible que nos encontremos de cara a una auditoria con archivos cifrados por esta herramienta, por lo que podríamos recurrir a la herramienta **file** para ver a que nos enfrentamos. 

```bash
file {file.enc}
# {file.enc}: openssl enc'd data with salted password
```
De esta manera veríamos el output **openssl enc'd data with salted password**, indicando que el archivo está en un formato cifrado utilizando **Openssl** y una protección con una determinada contraseña la cual ha sido utilizada con la técnica **salting**. 

## Cifrar
Esto puede ser replicable de nuestro lado, para entender como funciona podríamos hacer uso de openssl para encriptar cierta data almacenada en un archivo y exportarla a uno nuevo haciendo uso de una contraseña.

```bash
openssl aes-256-cbc -in {initial_data} -out {file.enc}
```
Luego de correr el comando anterior indicando que queremos cifrar la data del archivo **{initial_data}** haciendo uso del cifrado **aes-256-cbc** y exportando la data al archivo final **{file.enc}** nos pedirá una contraseña la cual nos servirá posteriormente para desencriptar el archivo final. 

## Descifrar 

Una vez que tengamos en tenencia un archivo cifrado, tenemos que saber el cifrado que se utilizo par cifrar la data y la contraseña. 

```bash
openssl {used_chiper} -in {file_to_decrypt} -pass 'pass:{used_password}'
```
Una vez corrido el comando anterior indicando el correspondiente cifrado y la correspondiente contraseña podríamos descifrar la data. 

----
# Explotación 

Teniendo en cuenta la explicación anterior, podríamos llevarlo a un entorno en el cual no conozcamos el cifrado ni la contraseña, ya que el archivo cifrado podría ser un archivo recuperado en algún punto de una auditoria, de cara a este escenario podríamos pensar en **fuerza bruta**, haciendo uso de un diccionario de los posibles cifrados, así como otro para las posibles contraseñas.

De esta manera simplemente deberíamos ir probando uno por uno hasta dar con el cifrado y la contraseña correspondiente, teniendo en cuenta que el output de la herramienta **openssl** en caso de indicar una contraseña erronea será en realidad **stderr** dando como resultado un código de estado no exitoso. 

```bash
#!/bin/bash

# Ctrl + c 

function ctrl_c(){
  echo -e "\n\n\t[!] Quiting...\n\n"
  tput cnorm; exit 1 
}

trap ctrl_c INT 

# Ciphers 

declare -a ciphers=("AES-128-CBC AES-128-CFB AES-128-CFB1 AES-128-CFB8 AES-128-CTR AES-128-ECB AES-128-OFB AES-192-CBC AES-192-CFB AES-192-CFB1 AES-192-CFB8 AES-192-CTR AES-192-ECB AES-192-OFB AES-256-CBC AES-256-CFB AES-256-CFB1 AES-256-CFB8 AES-256-CTR AES-256-ECB AES-256-OFB AES128 AES192 AES256 BF BF-CBC BF-CFB BF-ECB BF-OFB CAMELLIA-128-CBC CAMELLIA-128-CFB CAMELLIA-128-CFB1 CAMELLIA-128-CFB8 CAMELLIA-128-CTR CAMELLIA-128-ECB CAMELLIA-128-OFB CAMELLIA-192-CBC CAMELLIA-192-CFB CAMELLIA-192-CFB1 CAMELLIA-192-CFB8 CAMELLIA-192-CTR CAMELLIA-192-ECB CAMELLIA-192-OFB CAMELLIA-256-CBC CAMELLIA-256-CFB CAMELLIA-256-CFB1 CAMELLIA-256-CFB8 CAMELLIA-256-CTR CAMELLIA-256-ECB CAMELLIA-256-OFB CAMELLIA128 CAMELLIA192 CAMELLIA256 CAST CAST-cbc CAST5-CBC CAST5-CFB CAST5-ECB CAST5-OFB ChaCha20 DES DES-CBC DES-CFB DES-CFB1 DES-CFB8 DES-ECB DES-EDE DES-EDE-CBC DES-EDE-CFB DES-EDE-ECB DES-EDE-OFB DES-EDE3 DES-EDE3-CBC DES-EDE3-CFB DES-EDE3-CFB1 DES-EDE3-CFB8 DES-EDE3-ECB DES-EDE3-OFB DES-OFB DES3 DESX DESX-CBC RC2 RC2-40-CBC RC2-64-CBC RC2-CBC RC2-CFB RC2-ECB RC2-OFB RC4 RC4-40 SEED SEED-CBC SEED-CFB SEED-ECB SEED-OFB")

# Brute Force

if [ ! "$1" ]; then
  echo -e "\n\n\t[!] Usage: $0 {to_decrypt_file}\n\n"
  exit 1
else
  decrypt=$1
  dictionary="/usr/share/wordlists/rockyou.txt"
  tput civis  
  for cipher in ${ciphers[@]}; do
	  /usr/bin/cat $dictionary | while read line; do
	    /usr/bin/openssl $chipher -d -in $decrypt -pass "pass:$line" &>/dev/null && echo -e "\n\n\t[+] Password found: $line\n\n" && exit 0
	  done
  done; tput cnorm
fi
```

