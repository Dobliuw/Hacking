------
- Tags: #ataque #windows #basico #teoria #practica 
-----

# AS-REP Roast 

### Un ataque AS-REP Roast es un tipo de ataque de seguridad informático contra el protocolo Kerberos. Este ataque se acontece cuando uno de los Usuarios del Dominio tiene seteado el Atributo **UF_DONT_REQ_PREAUTH** lo que le permite solicitar un TGT a Kerberos (KDC) sin necesidad de proporcionar contraseña. En este mismo TGT se encuentra el Hash NTLMv2 del usuario en cuestion, que luego podriamos intentar crackear con fuerza bruta para obtener la contraseña del usuario.

## Funcionamiento de Kerberos: [[KERBEROS_AUTHETICATION_FLOW]]

---- 

# Explotación 

### Se puede dar el caso que auditando un sistema windows nos encontremos con el **DC (Domain Controler)** y con herramientas como [kerbrute](https://github.com/ropnop/kerbrute) enumeremos una lista de usuarios potenciales devolviendonos está herramienta los usuarios válidos, de manera que nos encontramos con una lista de usuarios válidos, en este momento es donde podemos pensar en un **AS-REP Roast** para válidar si existen usuarios que tengan la opción **UF_DONT_REQ_PREAUTH**, donde, en caso de tenerla podríamos solicitar un **TGT** el cual nos otorgaría el hash NTLMv2 para intentar crackear. 

#### En este caso haremos uso de [impacket](https://github.com/fortra/impacket) 

```bash
# Ver abajo de todo las opciones 
impacket-GetNPUsers.py 

# Una de las opciones (4) es para intentar obtener el TGT de una wordlist de usuarios
impacket-GetNPUsers.py {domain}/ -no-pass -usersfile {file.txt}
```

### En caso de que algun usuario tenga la configuración **UF_DONT_REQ_PREAUTH** seteada, podríamos obtener el hash **NTLMv2** e intetar crackear este. 

### Adicionalmente, otra manera de obtener el hash NTLMv2 dada una lista de usuarios, sería con la herramienta utilizada previamente como **kerbrute**, donde en algunos casos detecta la configuración **UF_DONT_RE_PREAUTH** seteada y se encarga de a la par que validarnos el usuario, dumpearnos su hash correspondiente. 

```bash
kerbrute userenum --dc {target_ip} -d {domain} {file_users.txt}
```

