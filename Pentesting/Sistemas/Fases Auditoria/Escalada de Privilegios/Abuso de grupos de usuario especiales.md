----
- Tags: #escalada #teoria #practica 
----

# Abuso de grupos de usuario especiales

### En el contexto de Linux, los **grupos** se utilizan para **organizar** a los usuarios y **asignar permisos** para acceder a los recursos del sistema. Los usuarios pueden pertenecer a uno o varios grupos, y los grupos pueden tener diferentes niveles de permisos para acceder a los recursos del sistema. 

### Existen grupos especiales en Linux, como **lxd** o **docker**, que se utilizan para permitir a los usuarios ejecutar contenedores de manera segura y eficiente. Sin embargo, si un usuario malintencionado tiene acceso a uno de estos grupos, podría aprovecharlo para obtener privilegios elevados en el sistema.

### Por ejemplo, si un usuario tiene acceso al grupo **docker**, podría utilizar la herramienta docker para desplegar nuevos contenedores en el sistema. Durante el proceso de despliegue, el usuario podría aprovecharse de las **monturas** para hacer que ciertos recursos inaccesibles en la máquina host estén disponibles en el contenedor. Al ganar acceso al contenedor como usuario **root**, el usuario malintencionado podría inferir o manipular el contenido de estos recursos desde el contenedor. 

# Escalada

### El riesgo de que un usuario contenga grupos determinados, como podría ser **docker**, **adm**, **lxd**, entre otros, deriva a raíz de los permisos que estos grupos arrastran con sigo, por ejemplo, en el caso de docker como mencionamos anteriormente se podría aprovechar de sus permisos ciertamente privilegiados para en base a una imagen desplegar un contenedor en el cual haciendo uso de monturas, montar la raíz del sistema en el contenedor para una vez dentro poder acceder a **cualquier** recurso (**docker run -dit --name pwn -v /:/mnt/root ubuntu**).

### En el caso del grupo **adm** conlleva un riesgo dado que es un grupo el cual suele tener permisos para la lectura de **logs** del sistema, por lo que si buscáramos los logs a los cuales tiene acceso (**find /var/log -group adm 2>/dev/null**) veríamos ciertos logs a los cuales tendríamos permisos de lectura pudiendo así llegar a información sensible en algunos casos. 

### En caso del grupo **lxd** en un caso muy similar a docker, podemos hacer uso de scripts automatizados encontrados con **searchsploit** o google para explotar la vulnerabilidad de montar toda la raíz del sistema en una ruta específica del contenedor.

### Para agregar un usuario a un grupo específico podemos hacer uso del comando **usermod -a -G {group} {user}** y para eliminar a un usuario de un grupo los comandos **usermod -d -G {group} {user}**  o **gpasswd -d {user} {group}**. 