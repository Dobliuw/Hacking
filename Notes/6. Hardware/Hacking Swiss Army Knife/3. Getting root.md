# Root device

Un dispositivo **Android rooteado** es aquel en el que se ha *obtenido acceso de superusuario* (**root**) al sistema operativo, lo que permite al usuario tener un control total sobre el dispositivo y modificarlo más allá de las limitaciones impuestas por el fabricante. Como mencionamos, esto implica la capacidad de realizar cambios profundos en el sistema, como eliminar aplicaciones preinstaladas, instalar aplicaciones que requieren acceso root, personalizar la interfaz y mucho más.

---
# Options to root device in this point 

Como mencionamos al final del artículo [[1. Baseline documentation]], la idea es *extraer la imagen del sistema* para modificarla/parchearla con [Magisk](https://github.com/topjohnwu/Magisk). Ahora bien, cual es el problema de esto? Que requerimos que el dispositivo este rooteado, por lo que esto nos deja tres opciones sobre la mesa, sientanse libres de seleccionar cualquiera no coincida con la descrita en este artículo.

1. Flashear un `boot.img`parcheado con *Magisk* (Clasic method).
	-  Utilizamos el `boot.img` original (Obtenido del [factory image](https://developers.google.com/android/images)).
	- Lo parcheamos desde otro Pixel igual o un emulador Magisk.
	- Lo flasheamos mediante `fastboot`: 
		```bash 
		fastboot flash boot patched.img
		 ```
	-   Con root activo, ya podríamos dumpear cualquier partición:
		```bash
		dd if=/dev/block/by-name/boot of=/sdcard/boot.img
		```
		> [!info] Este es el camino más seguro para el primer root y luego ya trabajariamos únicamente con nuestro dispositivo.
		
2. Usar recovery custom temporal (TWRP/PixelOS recovery modificado).
	- Bootear (No flashear) una imagen de recovery que tenga acceso roote temporal:
		```bash
		fastboot boot twrp.img
		```
	- Desde ese recovery, montar y copiar `/dev/block/by-name/boot` a la SD o a la PC.
	- Luego podemoss parcharlo o modificarlo sin haber instalado root permanente todavía.
	> [!info] El Pixel 6 no tiene TWRP oficial estable, pero si hay recoveries modificados de la comunidad.

3. Hacer un boot temporal con *Magisk* ya inyectado.
	- Creamos un `boot.img`modificado con Magisk en una PC.
	- Booteamos en RAM sin escribir nada:
		```bash
		fastboot boot magisk_patched.img
		```
	- Ese boot nos dará root tempral hasta el próximo reinicio, suficiente para dumear la `boot.img` original del slot activo.
	> [!info] Esta técnica es muy útil porque no toca nada en el teléfono hasta que decidamos instalar root permanente. Y si, efectivamente esta es la técnica que personalmente llevaré a cabo y detallaré en este artículo.

----
# Inyecting Magisk to a temp boot.img

Para inyectar **Magisk** en una imagen de OS, primero necesitamos como base esa imagen. Esta imagen la obtendremos de [Google Factory Image](https://developers.google.com/android/images), donde deberemos aceptar los terminos y servicios y luego podríamos ver el listado de dispositivos del cual podriamos obtener las imagenes, en mi caso el apartado de [Pixel 6](https://developers.google.com/android/images#oriole).

Para saber que versión descargar, nos dirigimos a *Settings* > *About phone* > *Build Number* en el dispositivo Android. Una vez identificado, simplemente descargamos la versión apropiada, extraemos el `.zip` final y visualizaremos un archivo `payload.bin` el cual, dado que Google ya no incluye los archivos `boot.img`sueltos, deberemos desempaquetar de este archivo porque ahora viene empaquetado.

Para desempaquetar el archivo `payload.bin`, podremos utilizar la herramienta [payload-dumper-go](https://github.com/ssut/payload-dumper-go.git):

- Opción *Go* (Recomendada):
```bash
git clone https://github.com/ssut/payload-dumper-go.git
cd payload-dumper-go
go build
sudo cp payload-dumper-go /bin
payload-dumper-go -o {output/path/file} ~/Downloads/payload.bin
```

Una vez ejecutado este comando, veremos en nuestra ruta deseada (*{output/path/file}*) varios archivos `.img`, en nuestro caso solo utilizaremos `boot.img`, por lo que los demás tranquilamente podrían ser eliminados.

Posteriormente, cargaremos el `boot.img`a nuestro dispositivo para dejarlo listo y continuar con la descarga e inyección de *Magisk*. Para esto podríamos hacer algo como:

```bash
adb push boot.img /sdcard/Documents
```

Una vez subida la imagen a alguna ruta deseada de nuestro dispositivo, en mi caso `/sdcard/Documents`, deberemos instalar [Magisk](https://github.com/topjohnwu/Magisk) en nuestro dispositivo. Esto también podemos hacerlo desde nuestra PC (O directamente desde nuestro dispositivo) dirigiendonos a [releases](https://github.com/topjohnwu/Magisk/releases) y descargando el `.apk` de la última versión:

```bash
adb install Magisk-vXX.X.apk
```

Una vez instalado Magisk en el dispositivo, deberemos abrirlo y veremos algo tal que así:

<html>
<center>
<img style="height: 1000px" src="../../../0. Images/Pasted image 20250812232138.png" alt="Fastboot Mode"/>
</center>
</html>

Deberemos presionar *Magisk* -> **Instalar**, posteriormente en la sección de *Select and Patch a File* deberemos navegar por los archivos de nuestro dispositivo en búsqueda de la imagen `boot.img` que previamente habíamos cargado en una ruta deseada (Representada como *{output/path/file}*).

Una vez instalado *Magisk* en nuestra `boot.img` nos dejará una nueva imagen, como por ejemplo en mi caso `magisk_patched-29000_x4V69.img` en un path que nos informará Magisk al final (`/storage/emulated/0/Download/`):

<html>
<center>
<img style="height: 500px" src="../../../0. Images/Pasted image 20250812233134.png" alt="Fastboot Mode"/>
</center>
</html>

Una vez localizada la imagen del sistema operativo modificada exitosamente con Magisk, podremos descargarnosla a la pc para posteriormente arrancar temporalmente desde esta imagen (Donde tendremos acceso root temporalmente):

```bash
# Download the magisk img from the device
adb pull /storage/emulated/0/Download/magisk_patched-XXXXX_XXXXX.img
# Reboot and load the magis img into the RAM device
adb reboot bootloader
fastboot boot magisk_patched-XXXXX_XXXXX.img
```

- Esto **no escribe** en la memoria; el kernel parcheado se carga en RAM.
- Android iniciará con **root activo** (Temporal). Si abrieramos Magisk veriamos "*Installed: vXX.X*".


<html>
<center>
<img style="height: 560px" src="../../../0. Images/Pasted image 20250812234527.png" alt="Fastboot Mode"/>
</center>
</html>

En este punto, tendríamos en memoria RAM una imagen temporal la cual nos dará **acceso root** para obtener la imagen original y volver a realizar este proceso para rootear la imagen final.