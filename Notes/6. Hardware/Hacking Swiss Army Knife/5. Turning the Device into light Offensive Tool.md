# Rooted Device

Una vez que el dispositivo ya está rooteado de forma permanente con Magisk, ahora se nos abre el verdadero juego, ya que tenemos control total del sistema. Lo que nos permite convertir, en mi caso el *Pixel 6*, en una **herramienta ofensiva**, donde:

- Instalar un *terminal emulator* y darle root access.
- Configurar `ssh` para acceso remoto al teléfono.
- Montar un sistema de logs y backgus.
- Usar `apt`desde el *terminal emulator* (Si lo permite) y/o compilar paquetes desde fuentes.
- Montar un toolset como podría ser [Kali Nethunter](https://www.kali.org/get-kali/#kali-mobile).
- Habilitar OTG + adaptador para conectar ingerfaces USB (WiFi Sniffers, SDRs, etc.).
- Ocultar root de apps específicas (Magisk Hide / Zygisk).
- Crear perfiles de firewall (Con AFWall+ o iptables).
- Desactivar servicios innecesarios.

-----
# Base Enviroment

Llegado este punto, tenemos dos opciones:

1. Tener un sistema ligero semejante a "arch linux" en el cual podemos tener control de casi todo lo que viene en el y se instalará y moldearlo a nuestra necesidad, ejemplo orientarlo a un entorno de Hacking Ofensivo como en mi caso.
2. Instalar [Kali NetHunter](https://www.kali.org/docs/nethunter/):
	1. Version **lite**: Se necesita el dispositivo rooteado pero no se utilizarán funciones relevantes del kernel para ataques avanzados. (Está opción en mi caso irá vinculada con la *opción 1* descrita en este artículo) Será tener un *termux* en el cual dentro instalaremos *Kali NetHunter Lite*.
	2. Version **pro**: Se necesitará que el dispositivo tenga un kernel modificado creado por la comunidad, por nosotros o por Offensive Security.

En caso de que les interese la *opción* *1* o *2.1* la misma se detallará y realizará a continuación. En caso de seguir por la *opción* *2-2*, la misma continuará a partir de este punto en el artículo [[5.2 Installing custom recovery]].

# Ligth customizable OS (*Option 1*)

En mi caso utilizaré el *terminal emulator* más recomendado y por defecto que suele utilizarse/verse: [Termux](https://termux.dev/en/). Descargaremos el `.apk` del [sitio de f-droid](https://f-droid.org/en/packages/com.termux/) y posteriormente instalaremos la misma a la par que haciendo uso de `pkg` actualizaremos e instalaremos `tsu`, un biario que nos permitirá elevar privilegios dentro de *Termux*.

- Instalar Termux.
 ```bash
adb install termux.apk
```

Posteriormente, deberemos dar *acceso root* a *Termux*, para esto, abrimos termux:

```bash
pkg update && pkg upgrade -y
su
```

Simplemente ejecutamos el comando `su` y damos permisos *Forever* a la ventana de Magisk que nos saldrá. También instalaremos el comando `sudo` para *termux* desde la herramienta [sudo-termux]:

```bash
pkg install sudo
```

Finalmente, para dar comienzo a la instalación del *toolset ofensivo inicial* (Kali NetHunter) procederemos con la instalación de herramientas de compilación y desarrollo básicas:

> [!info] Installing special repos
> Ya que el dispositivo está rooteado, nos conviene habilitar los repositorios que contienen paquetes que pueden requerir permisos elevados como:
> ```bash
> pkg install root-repo
> pkg install unstable-repo
> ```

```bash
pkg install openssh tmux git make clang cmake python build-essential \
tcpdump iproute2 iptables procps termux-api libusb clang root-repo unstable-repo
```

- `root-repo`: Herramientas que requieren acceso root. (`tcpdump`, `aircrack-ng` , etc.).
- `unstable-repo`: Versiones más recientes de algunas utilidades que podrían romper algo.https://www.kali.org/docs/nethunter/nethunter-chroot-manager/

----
# Offensive toolset

Ya en este punto podríamos comenzar con la configuración de todo nuestro sistema a gusto, como cualquier linux, antes pasando por una breve explicación de lo que hasta ahora tenemos y lo que en mi caso me encargaré de enseñarles a dejar según lo que yo quise dejar en mi sistema.

La idea es sencilla, terminar teniendo el siguiente esquema a niveles generales:

- Dispositivo Android rooteado.
	- Termux con capacidad de privilegios.
	- Kali NetHunter Lite (*Opcional*).

Realizando la configuración me encontre al principio un poco mareado entre "distintas shells" como lo era la de `adb shell` vs la de *termux*. Así que aca va una explicación más detallada de la idea final.
###### Real Operative System

Cuando obtenemos una shell o ejecutamos comandos a través de una con el comando: 

```bash
adb shell
```

Estamos entradn en una **shell del sistema Android**:
- Por defecto, estamos como *shell user* (UID *2000*), que tiene permisos limitados.
- Si el dispositivo está rooteado y Magisk inyectó `su` correctamente, podríamos elevar estos privilegios con:
	```bash
	su
	```
Esto sí es **root real del sistema**, es decir, acceso directo al *sistema de archivos de Android completo* (`/system`, `/data`, `/vendor`, etc.).

En este contexto:

- `/` es la raíz del sistema Android real.
- `/data/data` contiene el *directorio de datos* de *todas las apps instaladas* (Obviamente incluyendo **Termux**).
- Modificar cualquier cosa desde esta shell es equivalente a estar modificando directamente Android.
###### Termux (User enviroment inside Android)

Cuando abrimos **Termux**, por otro lado, *no estamos en root real*, sino en un *entorno aislado* dentro de `/data/data/com.termux/files/home`.

- Esto es como tener una mini distribución Linux embebida, con si tipico y propio sistema de archivos (`/bin`, `/etc`, `/usr`, etc.), pero todo guardado dentro de la carpeta de la app Termux.
- Por eso cuando corremos `ls /` en Termux, obtenemos un *Permission denied*, estamos intentando leer como un usuario (Por ejemplo `u0_a279`) la raíz del sistema Android, sin tener permisos para esto.

En este contexto:

- Termux funciona como un "Kali miniatura" que vive dentro de Android.
- Sin root, esto está muy limitado ya que no podríamos modificar interfaces de red, capturar paquetes, etc.
- Con root (`tsu` o `su`), podemos salir de la jaula y manipular el sistema Android real.

----
 
 Dicho esto, los dejo con un sistema listo para hackear, solo que como mencioné, un poco limitado. En caso de querer unificar esta opción con la integración de *Kali NetHunter Lite* visitar el artículo [[5.1 Installing Kali NetHunter Lite]].