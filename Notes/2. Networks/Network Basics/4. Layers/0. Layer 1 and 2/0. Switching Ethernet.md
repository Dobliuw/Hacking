# Ethernet Encapsulation

**Ethernet** es una de las dos tecnologías LAN utilizadas hoy en día, siendo la otra LAN Inalámbrica (WLAN). Ethernet utiliza comunicaciones por cable, incluyendo pares trenzados, enlaces de fibra óptica y cables coaxiales.

Ethner funciona en la *capa de enlace de datos* ([[0. Data Link Layer]]) y en la *capa física* ([[0. Physical Layer]]). Es una familia de tecnologías de red definidas en lso estándares IEEE 802.2 y 802.3. Ethernet soporta los siguientes anchos de banda de datos:

- 10 Mbps.
- 100 Mbps.
- 1000 Mbps (1 Gbps).
- 10.000 Mbps (10 Gbps).
- 40.000 Mbps (40 Gbps).
- 100.000 Mbps (100 Gbps).

Como se muestra en la siguiente imagen, los estándares de Ethernet definen tanto los protocolos de Capa 2 como las tecnologías de Capa 1:

![[ethernet_standars_layer1_and_2_example_image.png]]

Ethernet se define mediante *protocolos de capa física* y de *capa de enlace de datos*.

----
# Data Link Sublayers (Ethernet)

Como vimos en la sección de [[0. Data Link Layer#Sublayers]], los protocolos *IEEE 802.2 LAN/MAN*, incluyendo **Ethernet**, utilizan las dos subcapas independientes siguientes de la capa de enlace de datos para operar. Son el `Logical Link Control` (`LLC`) y el `Medium Access Control` (`MAC`), como se muestra en la imagen.

Como vimos, los roles de estas dos subcapas son:

- `Logical Link Control` (`LLC`): Esta subcapa IEEE 802.2 se comunica entre el software de red en las capas superiores y el hardware del dispostivio en las capas inferiores. Coloca en la trama información que identifica qué protocolo de capa de red se utiliza para la trama. Esta inforamción permite que múltiples protocolos de Capa 3, como IPv4 e IPv6, utilicen la misma interfaz de red y medios.

- `Medium Access Control` (`MAC`): Esta subcapa (IEEE 802.3, 802.11 o 802.15) se implementa en hardware y es responsable de la encapsulación de datos y coontrol de acceso a medios. Proporciona direccionamiento de capa de enlace de datos y está integrado con varias tecnologías de capa física. 

![[data_link_sub_layers_llc_mac_example_image.png]]

----
# Sublayer MAC

La subcapa **MAC** es responsable de la *encapsulación de datos* y el *acceso a los medios* ([[0. Network Components#Network media]]).
#### Data Encapsulation

La encapsulación de datos IEEE 802.3 incluye lo siguiente:

- **Trama de Ethernet**: Esta es la estrcutura interna de la trama Ethernet.
- *Direccionamiento Ethernet*: La trama Ethernet incluye una dirección MAC de origen y destino para e ntregar la trama Ethernet de NIC Ethernet a NIC Ethernet en la misma LAN.
- *Detección de errores Ethernet*: La trama Ethernet incluye un avance de secuencia de verificación de trama (FCS) utilizado para la detección de errores.
#### Access to the media 

Como se muestra en la imagen, la subcapa MAC IEEE 802.3 incluye las específicaciones para diferentes estándares de comunicación Ethernet sobre varios tipos de medios, incluyendo *cobre* ([[0. Copper Wiring]]) y *fíbra* ([[0. Fiber Optic Wiring]]).

![[sublayer_mac_estandars_example_image.png]]

Recordemos que Ethernet heredado utiliza una topología de bus o hubs, es un medio compartido, medio dúplex. Ethernet a través de un medio dúplex utiliza un método de acceso basado en contención, detección de acceso múltiples/detección de colisiones (CSMA/CD). Esto garantiza que sólo un dispositivo esté transmitiendo a la vez. CSMA/CD permite que varios dispositivos compartan el mismo medio dúplex, detectando una colisión cuando más de un dispositivo intente transmitir simultáneamente. También proporciona un algortimo de retroceso para la retransmisión.

Las LAN Ethernet de hoy utilizan swtiches que funcionan en dúplex completo. Las comunicaciones dúplex completo con swtiches Ethernet no requiere control de acceso a través de CSMA/CD.

----
# Layers in a Ethernet Frame

El tamaño mínimo de una **trama Ethernet** es de *64 bytes*, y el máximo es de *1518 bytes*. Esto incluye todos los bytes del campo de dirección MAC de destino a través del campo de secuencia de verificación de trama (FCS). El campo preámbulo no se incluye al describir el tamaño de una trama.

Cualquier trama de menos de 64 bytes de longitud se considera un framento de colisión o una trama corta, y es descartada automáticamente por las estaciones receptoras. Las tramas de más de 1500 bytes de datos se consideran *jumbos*.

Si el tamaño de una trama transmitira es menor que el mínimo o mayor que el máximo, el dispositivo receptor descarta la trama. Es posible que las tramas descartadas se origienen en colisione u otras señales no desadas. Ellas se consideran inválidas. Las tramas jumbo suelen ser compatibles con la mayoría de los Switches y NIC Fas Ethernet y Gigabit Ethernet.

La imagen a continuación muestra cada campo en una trama Ethernet:

![[layers_ethernet_frame_sizes_example_image.png]]

Cada uno de estos campos tiene una función específica que se describirá a continuación:

| Ethernet Frame Field       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| -------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Preámbulo` y `SFD`        | El *Preámbulo* (7 bytes) y el *Start Frame Delimiter* (*SFD*), también llamado Inicio de trama (1 byte), son los campos que se utilizan para la sincronización entre el envío y la recepción de dispositivos. Estos primeros 8 bytes de trama son utilizados para llamar la atención de los nodos receptores.                                                                                                                                                                                                                                                                                                                                                                             |
| `Dirección MAC de Destino` | Este campo (*Destination MAC Address*) de 6 bytes es el identificador del destinatario deseado. Como sabemos, esta dirección es utilizada por la Capa 2 para ayudar a los dispositivos a determinar si una trama está dirigida a ellos o no. La dirección en la trama es comparada con la dirección MAC en el dispositivo. SI hay una coincidencia, el dispositivo aceptará la trama.                                                                                                                                                                                                                                                                                                     |
| `Dirección MAC de Origen`  | Este campo (*Origin MAC Address*) de otros 6 bytes identifica la NIC o la interfaz de origen de la trama.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `Tipo`/`Longitud`          | Este campo (*Type/Length*) de 2 bytes identifica el protocolo de capa superior encapsulado en la trama Ethernet. Los valores comunes son, en hexadecimal, *0x800* par IPv4, *0x86DD* para IPv6 y *0x806* para ARP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `Datos`                    | Este campo (*Data*) ocupa de 46 a 1500 bytes y contiene los datos encapsulados de una capa superior, que es una PDU genérica de Capa 3, o más comúnmente, un paquete IPv4. Todas las tramas deben tener, al menos, 64 bytes de longitud. Si un paquete pequeño es encapsulado, bits adcinoales llamados *pad* se utilizan para umentar el tamaño de la trama a este tamaño mínimo.                                                                                                                                                                                                                                                                                                        |
| `FCS`                      | Este campo (*Frae Check Sequence*), también conocido como Secuencia de verificación de trama (4 bytes) se usa para detectar errores en una trama. Utiliza una coprobación cíclica de redundancia (CRC). El dispositivo de envío incluye los resultados de un CRC en el campo FCS de la trama. El dispositivo receptor recibe la trama y genera un CRC para buscar por errores. Si los cálculos coincide, singifica que no se produjo ningún error. Cálculos que no coinciden son una indicación de que los datos han cambiado, por lo tanto, la trama de descarga. Un cambio en los datos podría ser el resultado de una interrupción de las señales eléctricas que representan los bits. |
