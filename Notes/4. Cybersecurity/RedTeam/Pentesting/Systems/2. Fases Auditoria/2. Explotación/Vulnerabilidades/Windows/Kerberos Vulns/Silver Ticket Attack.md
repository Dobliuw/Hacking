------
- Tags: #teoria #practica #ataque 
-----
# [Silver Ticket Attack](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/silver-ticket)
El ataque **Silver Ticket** es una técnica de explotación utilizada en entornos que emplean el protoclo de autenticación de [[Kerberos]]. Permite a un atacante generar un Ticket Granting Service (TGS). Un **Silver Ticket** es un ticket de autenticación falsificado que aveces se crea cuando un atacante roba la contraseña de una cuenta.

----
# Explotación 

- ### **Recolección de información**: El atacante comienza recopilando información sobre la infraestructura de red objetivo. Esto puede incluir la identificación de controladores de dominio, servidores de aplicaciones y serviciios de alto valor.

- ### **Obtención de credenciales**: El atacante primero necesita obtener credenciales válidas para algún servicio o sistema dentro de la red. Esto podría lograrse a través de métodos como **phishing**, robo de contraseñas, explotación de vulnerabilidades o el uso de credenciales filtradas.

- ### **Generación del Silver Ticket**: Una vez que al atacante tiene acceso a las credenciales se un SPN (Service Principal Name) puede generar un **Silver Ticket** ( Que no deja de ser un TGS), pero con datos robados.

- ### **Uso del Silver Ticket**: El atacante utiliza el Silver Ticket para autenticarse ante un servicio o recursos específico dentro de la red. Esto puede incluir servidores de archivos, base de datos o cualquier otro recurso protegido por el sistema de autenticación de [[Kerberos]].

----
# PoC

Por ejemplo, podemos estar en tenencia de el Hash NT de un usuario perteneciente a una cuenta de servicio (SPNs) el cual podemos utilizar para intentar realizar un **Silver Ticket Attack**. 
En este caso, es crucial tener en cuenta que debemos enfrentarnos a un escenario muy específico en el cual tenemos que tener:
**1)** El Hash NT de un usuario.
**2)** Que el usuario sea una SPNs (Cuenta de Servicio).
**3)** El SID del Domain (Security Identifier): Identificador único y alfanumérico que se utiliza en los sistemas operativos Windows para identificar de manera única a usuarios, grupos y objetos de seguridad dentro de un dominio o una red.

Para obtener el Hash NT del usuario podría ser obtenido por técnicas como [[Kerberoasting Attack]], [[SMB Relay]], explotación de vulnerabilidades, etc. Una vez entenencia del mismo, podríamos intentar obtener el SID haciendo uso de herramientas de la suite de **impacket** como **imapacket-getPac**.

```bash
impacket-getPac -targetUser {username} -hashes :{nt_hash} {domain}/{username}
```
Una vez que tengamos el SID del dominio, solo faltaría solicitar el **Silver Ticket** (TGS) con herramientas como **impacket-ticketer** o **ticketer.py**

```bash
python3 ticketer.py -nthash {hash_nt} -domain-sid {sid} -domain {domain} -spn {service}/{server} {user} 

impacket-ticketer -nthash {hash_nt} -domain-sid {sid} -domain {domain} -spn {service}/{server} {user} 
```
Una vez obtenido el ticket, como siempre solo hace falta exportarlo con la variable de entorno **KRB5CCNAME** y hacer uso de herramientas como **impacket-psexec** o **psexec.py** para la ejecución de acciones de manera remota.

```bash
export KRB5CCNAME={path/to/user.ccache/downloaded}

python3 psexec.py {dc}/{username}@{ip} -k -no-pass

impacket-psexec {dc}/{username}@{ip} -k -no-pass
```
Obteniendo así, una vez más, la [[RCE - (Remote Command Execution)]].