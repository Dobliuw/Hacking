# DCsync Attack

Un **Dc Syn Attack** es un tipo de ataque informático que se enfoca en comprometer un controlador de dominio (DC) en un entorno de Active Directory. Este ataque se basa en el uso de credenciales del atacante para solicitar información sobre cuentas de usuario desde el controlador de dominio.

Este ataque le permite al atacante simular el comportamiento del Domain Controller y recuperar datos de conraseñas a través de replicación de domino. 

El proceso de este ataque suele ser en líneas generales de la siguiente manera:

- El atacante descubre el domain controller para solicitar la replicación.
- El atacante solicita la replicación de usuarios mediante *GetNCChangesolic*
- El DC retorna la respuesta, inluyendo los hashes de las contraseñas de los usuarios. 

 Muchas veces la infraestructura de las organizaciones necesita más de un DC, para el AD. Para mantener la choerencia de un entorno con más de un DC , es necesario que los objetos de AD se repliquen a través de esos DC. La mayoria de las tareas relacionadas con la replicación se especifican en el Protocolo remoto de Serivico de replicación de directorios. 

Por lo tanto, cuando veamos un usuario con los permisos **GetChanges** y **GetChangesAll**, ya que estos permisos le permiten a un usuario obtener información sobre los cambios realizados en Active Directory, incluidos los cambios en las credenciales de cuentas de usuarios. 

-----
# Explotación (PoC)

 Cuando un usuario posee los permisos de *GetChanges* y *GetChangesAll* se podrá realizar una replicación de dominio, de esta manera podemos usar herramientas como **impacket-secretsdump** para obtener los hashes de las contraseñas de los usuarios:

```bash
impacket-secretsdump {domain}/{user}@{target_ip}
```

Una vez ejecutado el comando anterior, obtendremos un output con todos los hashes NT de los usuarios del DC, en el mejor de los casos incluyendo el del usuario Administrador en donde su credencial no haya sido cambiada. Una vez teniendo el hash de la contraseña del usuario, podemos utlizar la herramienta **impacket-psexec** o **impacket-wmiexec** (Herramientas de línea de comandos que permite a los administradores de sistemas ejecutar comandos), para solicitar un consola interactiva.

```bash
impacket-psexec {domain}/{user}@{target_ip} --hashes :{hash}

psexec.py {domain}/{user}@{target_ip} --hashes :{hash} 

impacket-wmiexec {domain}/{user}@{target_ip} --hashes :{hash}

wmiexec.py {domain}/{user}@{target_ip} --hashes :{hash}
```
