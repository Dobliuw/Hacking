----
- Tags: #ataques #teoria #practica #reverse
----
# Reverse Engineering
La **ingeniería inversa** es un proceso o método a tavés del cual uno intenta comprender a través de razonamientos deductimos cómo un dispositivo, proceso, sistema o pieza de software creado previamente realiza una determinada tarea, esto con muiy poca información acerca de cómo lo hace.

----
# Reverse Engineering an API
Si una API no está docuimentada o la documentación no está disponible para nosotros, existen varias soluciones para hacer uso de ingeniería inversa y poder generar "nuestra propia docuemntación", en este caso se mencionaran dos maneras, la primera haciendo uso del **proxy** de [[Postman]] y otra utilizando la herramienta **mitmproxy2swagger**

------
# [[Postman]] proxy

Como sabemos [[Postman]] es una herramienta que nos permite trabajar de manera ordenada y fácil con peticiones a endpoints de una API, esta suele ser utilizada para debugging por los propios desarrolladores. En este caso la usaremos para configurar un proxy y de esta manera capturar todas las peticiones que se realizan en una web filtrando por lo que es de nuestro interez, tratandose de APIs en esta caso, podríamos configurar que se capturen todas las peticiones web que contengan la palabra **api**, o **v1**, **v2**, etc.
Esto está explicado en el documento [[Postman]] en el apartado de **Proxy**.

-------
# Mitmproxy2swagger
Primero empezemos por entender que es **mitmproxy**, una herramienta muy poderosa para profesionales de seguridad y desarrolladores, sus siglas provienen de **Man in The Middle Proxy**, se utiliza para interceptar, registrar y modificar el tráfico de red entre un cliente y un servidor. Comúnmente se utiiliza para análisis y pentesting.
Por otro lado **swagger** es un conjunto de herramientas y especificaciones que se utiliza para diseñar, construir y documentar APIs. La especificación principal de Swagger se denomina **OpenAPI Specification**, que proporciona una manera estándar de describir y documentar las APIs web de manera precisa y detallada.
En este contexto, **mitimrpoxy2swagger** es una herramienta que fuciona estas dos funcionalidades mencionadas anteriormente, teniendo así una gran vía potencial de realizar **Reverse Engineering** de APIs capturando las peticiones de interez para posteriormente volcarlas en un swagger.

```bash
# Instalación 
sudo pip3 install mitmproxy2swagger 
```
Una vez que tengamos instalada esta herramienta, haremos uso de la herramienta **mitmproxy** (`sudo apt install mitmproxy`) para ejecutar desde la consola el comando:

```bash
mitmweb
```
Al ejecutar este comando estaremos creando un proxy en el puerto 8080 y un servicio web con GUI en le puerto 8081, en donde veremos todas las peticiones que se iran capturando.

![[mitmweb.png]]
Una vez que tengamos las peticiones que son de nuestro interez capturadas, podemos hacer click en **File** y **save**, el cual nos guardara un archivo llamado **flows** que tendremos que pasarla a la herramienta **mitmproxy2swagger** para hacer la creación del mismo.

```bash
sudo mitmproxy2swagger -i {path_to_flows_file} -o spec.yml -p {target_domain_audited} -f flow
```
Al ejecutar este comando se nos creara el archivo **spec.yml** con el format listo para convertir el swagger, lo que es IMPORTANTE tener en cuenta es que todas las rutas capturadas apareceran con de la siguiente manera (**- ignore:{route}** ) lo cual debemos convertir a (**- {route}**), es decir que debemos eliminar el **ignore:** de todo el swagger.

```bash
cat spec.yml | sed 's/ignore://g' | sudo sponge spec.yml
```
Una vez modificadas estas líneas y las que sean de nuestra preferencia como el titulo, podemos volver a ejecutar el anterior comando agregando esta vez la flag **--examples** en caso de ser de nuestra preferencia para poder visualizar asi ejemplos de peticiones en el swagger.

```bash
sudo mitmproxy2swagger -i {path_to_flows_file} -o spec.yml -p {target_domain_audited} -f flow --examples
```
Una vez realizado esto, nuestro archvio spec.yml estará listo y podremos hacer uso de páginas como [swagger editor](https://editor.swagger.io) para importar el mismo y visualizar nuestro swagger. 

![[editor_swagger.png]]
Una vez que tengamos el archivo **.yml** algo que es importante tener en cuenta, que podemos importar el mismo en [[Postman]] para crear una collection con todas las urls de manera organizada.

![[import_yml_postman.png]]