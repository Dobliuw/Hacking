# ¿ Que es el **CORS** ? 

El **intercambio de recursos de origin cruzado (CORS)** es un mecanismo que permite que un servidor web **restrinja** el **acceso a recursos** de **diferentes orígenes**, es decir, de diferentes dominios o protocolos. CORSS se utiliza para proteger la privacidad y seguridad de los usuarios al evitar que otros sitios web accedan a información confidencial sin permiso. 

Supongamos que tenemos un aplicación web en el domion **"example.com"** que utiliza una API web en el domio **"api.example.com"** para recuperar datos. Si la aplicación web está correctamente configurada para CORS, solo permitirá solicitudes de origen cruzado desde el domion **"example.com"** a la API en el dominio **"api.example.com"**. SI se realiza un sollicitud desde un dominio diferente, como **"dobliuw.com"**, la solicitud será bloqueada por el navegador web. 

Sin embargo, si la aplicación web no está correctamente configurada para  CORS, un atacante podría aprobecharse de esta debilidad para acceder a recursos y datos confidenciales. Por ejemplo, si la aplicación web no valida la autorización del usuario para acceder a los recursos, un atacante podría inyectar código malicioso en un página web para realizar sollicitudes a la API de la aplicación en el dominio **"api.example.com"**. 

Un atacante podría utilizar herramientas automatiadas para probar diferentes valores de encabezados CORS y encontra un configuración incorrecta que permita la solicitud desde otro dominio. Si el atacante tien éxito, podría acceder a recursos y adatos condifenciales que no deberían estar disponibles desde su sitio web. Por ejemplo, podría recuperar la información de inicio de sesión de los usuarios, modificar losdatos de la aplicación, etc. 

----

# Evitar estos ataques 

Para prevenir este tipo de atauqe, es importante configurar adecuadamente CORS en la aplicación  web y asegurarse de que solo se permitan solicitudes de origen cruzado desde dominios confiables. 

----

# Explotación 

Para explotar esto, en caso de que a la hora de realizar una petición e interceptarla con [[Burpsuite]] veamos que acepta el intercambio de recursos de origen cruzado para todas las direcciones webs, es decir `Access-Control-Allow-Origin: *`, podríamos pensar en intentar abusar de esta mala configuración de cors. 
También se podría realizar un ataque de fuerza bruta remplazando la cabecera **Origin:** para ver los casos en el que se muestra en la respuesta la cabecera Access-Control-Allow-Origin (Sobre todo para subdominios).

Por lo que, por ejemplo, podriamos intentar crear un servidor 3ro propio en donde tengamos alojado un script para que cuando el usuario se meta realize una petición a un recurso privilegiado y obtener los datos de la web, incluso pudiendo clonar esta, por ejemplo el sig. script:  

```html 
<script>
   const reqListener = () => {
       document.getElementById("stolenInfo").innerHTML = req.responseText; 
   }

   const req = new XMLHttpRequest();
   req.onload = reqListener
   req.open('GET', 'http://localhost:5000/confidential', true); 
   req.withCredentials = true;
   req.send(); 

</script>


<center><h1> You has been pwned! </h1></center> 
<p id="stolenInfo"></p>
```

Algo que suele pasar es declararse las reglas de manera erronea, por ejemplo, para el dominio **dominio-a.com**, se permite CORS con **\*.dominio-a.com**, lo que permite burlar esta validación regristrando un dominio remplazanod el primer *.* por un caracter, pudiendo tener conexión con el servidor con un dominio como **Fdomino-a.com** 

