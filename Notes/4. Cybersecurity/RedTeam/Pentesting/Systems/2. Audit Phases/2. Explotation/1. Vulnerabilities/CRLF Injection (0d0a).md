provec# [Inyección CRLF](https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a)

Las **CRLF Injection (Inyecciones de Carriage Return Line Feed)** son ataques informátivos en los que un atacante introduce caracteres de retorno de carro (**CR**) y avance de línea (**LF**) en datos enviados a una aplicación web. Esto puede ser explotado para realizar diversas acciones maliciosas, como la inserción de contenido no deseado, la modificación de encabezados HTTP o incluso el secuestro de sesiones. Estos ataques se parovechan de la forma en que las aplicaciones interpretan y procesan los caracteres de controlo en las cadenas de texto. 

Esta téncica puede ser muy efectiva para **bypasear** el proceso de filtrado a través de la implementación de expresiones regulares (REGEX).

Ejemplo: `preg_match("/^.*[A-Za-z!#$%^&*()\-_=+{}\[\]\\|;:'\",.<>\/?]|[^0-9]$/", $user_id, $match)`

#### Original QUERY:
```sql
SELECT username FROM users WHERE user_id='%d'
```

#### CRLF Inyection:
```sql
SELECT username FROM users WHERE user_id="1%0d%0a' UNION+SELECT+schema_name+FROM+information_schema.schemata"
```

Esta query maliciosa abusa del payload URL encodeado **%0d%0a**, que se decodifican como secuencias de retorno de carro (**\r**) y salto de línea (**\n**). Por lo que a la hora de realizar la regex, esta será pasada debido a que la query maliciosa es indicada en una línea aparte, y el 1 inicial cumple con la regex (En un escenario en donde se puedan indicar números).

![[regex_CRLF_injection.png]]

Como se puede ver en este ejemplo, la introducción de un carácter de salto de línea resulta en la incapacidad de las expresiones regulares para efectura una coincidencia con nuestra entrada de deatos. Este efecto de evación propicia la capacidad de inyectar la consulta SQL de manera exitosa.