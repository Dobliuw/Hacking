# HTTP TRACE

El método **HTTP TRACE** es un método de solicitud utilizado principalemnte para la depuración en servidores web. Cuando se recibe una solicitud TRACE, el servidor devuelve en el cuerpo de la respuesta la solicitud origianl tal como fue recibida. Esto puede incluir todos los headers y el cuerpo de la solicitud, proporcionando  una visión completa de la misma

---
# Exploit

El problema de seguridad de este método surge cuando se utiliza en un entorno donde se transmiten datos sensibles, como cookies de sesión, otkens de autenticación o información de relevancia en encabezados personalizados. Si un atacante puede enviar una solicitud *TRACE*, puede obtener información confidencial que se reenvía en la respuesta del servidor. Esta información podría ser utilizada para la suplantación de identidad o el acceso no autorizado.

- Para verificar si un servidor tiene habilitado el método TRACE, se puede utilizar herramientas como `curl` o [[Burpsuite]]:

```bash
curl -X TRACE https://{domain.com}/{endpoint}
```

Si el servidor tiene habilitado el método TRACE, devolverá la solicitud original en el cuerpo de la respuesta, en caso de ver una respuesta nos quedaría análizar cuidadosamente la misma para lograr identificar si existen headers con información sensible.

![[Pasted image 20240807121208.png]]

En este ejemplo, vemos que el servidor devuelve un header llamado *X-Custom-IP-Authorization* el cual nos adjunta nuestra IP, como atacante, podríamos pensar que a lo mejor existen un rango de IPs permitidas, como podrían ser:

- localhost
- 127.0.0.1
- 172.17.0.x
- 192.168.1.x
- 192.168.0.x
- 0.0.0.0

De esta manera, en caso de que alguna IP de estas pueda estar en una white list, a lo mejor podría darse el caso de que tenga acceso a distintos apartados de la web que inicialmente no...

![[Pasted image 20240807121350.png]]

En este ejemplo, podemos ver como al realizar la solicitud normalmente estamos intentando filtrar por la palabra *admin* para ver si existe algún panel pero vemos que no tenemos suerte. Por el contrario, cuando realizamos la misma solicitud pero adjuntamos el header hayado (*X-Custom-IP-Authorization*) y lo probamos con alguna posible IP (**127.0.0.1**) vemos que obtenemos un apartado denominado *Admin panel*.

Como vemos, el método TRACE puede ser una herrmaienta de depuración útil para los desarrolladores, pero tmabién presenta un riesgo significativo si se habilita en servidores que manejan información sensible. Es curcial deshabilitar este método en entornos de producción y asegurar que los headers personalizados y las IPs no otorguen privilegios indebidos sin la debida autenticación y autorización.

---

Este ejemplo de explotación y caso a sido sacado del [Laboratorio de PortSwigger (Authentication bypass via information disclosure)](https://portswigger.net/web-security/information-disclosure/exploiting/lab-infoleak-authentication-bypass).

