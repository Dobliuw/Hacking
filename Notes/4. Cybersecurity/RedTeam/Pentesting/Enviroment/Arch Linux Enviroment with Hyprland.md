Podemos obtener algunas setups preconfigurados en [la página oficila de hyprland wiki](https://wiki.hyprland.org/Getting-Started/Preconfigured-setups/)
# Install Dependencies and Hyprland

Lo primero que debemos realizar a la hora de comenzar con la instalación de nuestro entorno de **Hyprland** es llevar a cabo la instalación de este (Sea manual desde el repositorio oficla o de los paquetes disponibles para Arch) junto a sus correspondientes dependencias, terminal y aplicaciones básicas.

```bash
# Update
sudo pacman -Syu
# Dependencies
sudo pacman -S git base-devel cmake meson ninja wayland wayland-protocols \
  xdg-desktop-portal xdg-desktop-portal-hyprland \
  seatd wlroots qt5-wayland qt6-wayland \
  vulkan-icd-loader vulkan-tools \
  pipewire wireplumber egl-wayland \
  pipewire wireplumber \
  libinput libliftoff libdisplay-info \
  ffmpeg qt5-base qt6-base

# Hyprland
sudo pacman -S hyprland
# Manual compilation
git clone https://github.com/hyprwm/Hyprland
cd Hyprland
make all
sudo make install

# Terminal and basic apps
sudo pacman -S kitty waybar wofi dunst grim slurp \
   xdg-utils xdg-users-dirs
```

- `xdg-desktop-portal-hyprland` se usa para soporte de portales (pantalla compartida, etc.).
- `pipewire` y `wireplumber` activos reemplazan a PulseAudio.
- `kitty`: terminal moderna compatible con GPU.
- `waybar`: barra de estado similar a Polybar.
- `wofi`: lanzador (tipo Rofi para Wayland).
- `dunst`: notificador.
- `grim` + `slurp`: capturas de pantalla.

# Basic enviroment configuration

El archivo `~/.config/hypr/hyprland.conf` será editado para la mayoría de configuraciones que deseemos llevar a cabo.

```bash
mkdir -p ~/.config/hypr
# Once installed hyprland the file /usr/share/hypr/hyprland.conf will be added by default
cp /usr/share/hypr/hyprland.conf ~/.config/hypr/hyprland.conf
```
###### PipeWire and PulseAudio

Para validar que servidor de audio estamos utilizando para saber si instalar `PieWire` podríamos hacer uso del comando:

```bash
ps aux | grep -E "pulseaudio|pipewire"
```

En caso de ver en la salida "*pulseaudio*" deberíamos llevar a cabo la instalación y configuración para activar para el respectivo usuario los servicios del servidor de audio `PipeWire` (Que **Hyprland** hace uso).

```bash
sudo pacman -S pipewire pipewire-audio pipewire-pulse wireplumber
systemctl --user enable --now pipewire pipewire-pulse wireplumber
```
###### Startx

`startx` es un script utilizado parai nciiar entornos gráficos manualmentes desde una consola TTY. Es una capa por encima de `xinit` y tradicionalmente es el encargado de lanzar entoronos gráficos como **X11**.

Ahora en el caso de **Hyprland** no es necesario utilizarlo, para saber si tenemos este binario podríamos lanzar un `which` y en caso de ver una ruta lo tendríamos instalado. En caso de hacer uso de `startx` deberíamos tener en el archivo `~/.xinitrc` la siguiente línea:

```bash
exec Hyprland
```
###### Systemd-logind

Este es un componente de `systemd` que maneja sesiones de usuario, dispositivos (Como teclados, mouse), permisos para acceder a TTYs, etc.

**Hyprland** necesita que el compositor tenga acceso al dispositivo gráfico, lo cual puede ser gestionado por:

- `systemd-logind`: Por defecto en la mayoría de distros modernas.
- `seatd`: Alternativa más livian, útil en entornos minimalistas o sin systemd.

Para saver si hacemos uso de `systemd-longd` podemos hacerlo mediante uno de los siguientes comandos:

```bash
# stdout will be active sessions list
loginctl
# Validate if the service is active
systemctl status systemd-logind
```

> [!warning] NVIDIA Special Considerations
> En caso de hacer uso de una placa de video de NVIDIA, necesitaremos habilitar algunas opciones en el archivo de configuración `~/.config/hypr/hyprland.conf` según lo indicado en la **Hyprland Wiki** en la sección disclaimer sobre [Nvidia con Hyprland](https://wiki.hyprland.org/Nvidia/):
> 
> - env = LIBVA_DRIVER_NAME,nvidia
> - env = XDG_SESSION_TYPE,wayland
> - env = GBM_BACKEND,nvidia-drm
> - env = \_\_GLX_VENDOR_LIBRARY_NAME,nvidia
> - env = WLR_NO_HARDWARE_CURSORS,1
>   
>La línea a continuación es crítica:
>  - exec-once = nvidia-settings --load-config-only
>    
> Adicional a esto, deberíamos ejecutar los siguientes comandos:
> ```bash
>   sudo echo "options nvidia-drm modeset=1" > /etc/modprobe.d/nvidia.conf
>   ```
>   
>   Y por último agregar los valores `nvidia`, `nvidia_modeset`, `nvidia_uvm`, `nvidia-drm` al *HOOK* **MODULES=()** en el archivo de configuración `/etc/mkinitcpio.conf`. Finalmente ejecutar el comando:
>   
>   ```bash
>   sudo mkinitcpio -P
>   ```

----
# Where are you?

Cuando iniciamos nuestra PC y nos aparece un login y luego accedemos a un entorno gráfico, probablemente podríamos estar utilizando un **Display Manager** como lo son `GDM`, `SDDM`, `LigthDM` o alguno similar (En caso de estar haciendo uso de un entorno gráfico como **X11**). Este componente se encarga de iniciar el entorno gráfico gestionar sesiones (Como *Plasma*, *GNOME*, *XFCE*, etc.).

Para verificar que **Display Manager** estamos utilizando podríamos ejecutar el siguiente comando: 

```bash
systemctl status display-manager
```

Esto podría mostrarnos algo como:

```bash
● gdm.service - GNOME Display Manager
● sddm.service - Simple Desktop Display Manager
```

Esto es clave, porque si queremos hacer uso de **Hyprland** *sin Display Manager* (Modo minimalista), lo iniciaremos desde *TTY*. Pero si queremos mantener el *DM* necesitaremos configurar Hyprland como opción válida de sesión gráfica.

----
# Launching Hyprland

###### Without Display Managerr

En caso de querer tener un entorno minimalista sin *Display Manager*, como se menciono anteriormente, se iniciará desde una *TTY*. En este punto lo que deberemos realizar será:

- Cerrar sesiones gráficas.
- Entrar a una TTY (`Ctrl+Alt+F2`).
- Iniciar sesión con usuario deseado.
- Ejecutar:

```bash
Hyprland
```

> Este comando lanzará **Hyprland** *si todo está bien configurado* y tenemos acceso a **Wayland** desde ese contexto.

> [!important] Make *Hyprland* works
> Para que **Hyprland** funcione, es fundamental que `seatd`o `systemd-logind` nos de acceso a `/dev/dri` y otros dispositiovs gráficos. Como se menciono más arriba en este mismo árticulo, si el comando `loginctl` nos devuelve sesiones activas, debería estar bien.
###### With Display Manager

En caso de querer seguir teniendo un *Display Manager* para poder seguir teniendo la opción de un escritorio tradicional deberemos crear un archivo `.desktop` en `/usr/share/wayland-sessions/hyprland.desktop` si no existe, por ejemplo: 

```bash
sudo nano /usr/share/wayland-sessions/hyprland.desktop
```

- Contenido de archivo **hyprland.desktop**:

```ini
Name=Hyprland
Comment=Dynamic tiling Wayland compositor that doesn't suck
Exec=Hyprland
Type=Application
X-GDM-Session-Type=wayland
DesktopNames=Hyprland
```

Luego deberemos cerrar sesion y desde la pantalla de login seleccionaremos como sesión **Hyprland (Wayland)** y luego iniciamos sesión normalmente.

> Si esto funciona, estaremos corriendo **Hyprland** desde nuestro *Display Manager*, lo cual puede ser útil mientras terminamos de configurar todo.

> [!info] Is *Hyprland* running?
> Una vez dentro de la sesión, para saber si *Hyprland* esta corriendo podríamos hacer uso de los siguientes comandos:
> ```bash
> echo $XDG_SESSION_TYPE
> # This should return "wayland"
> 
> echo $XDG_CURRENT_DESKTOP
> # This should return "Hyprland"
> 
> loginctl show-session $(loginctl | grep $(whoami) | awk '{print $1}') -p Type
> # Confirm that the session is "wayland" type
> ```
> 
> Otro comando que podríamos porbar para saber los *monitores conectados* en *Hyprland* es:
> 
> ```bash
> hyprctl monitors
> ```

----
# Hyprland Sintax

El archvo `~/.config/hypr/hyprland.conf` *tiene su propia sintexis declarativa* para configurar *bindings de teclas*, *comporatientos del sistema* de ventanas y demás. En comparación al entorno llevado a cabo con `bspwm` y `sxhkd` ([[Hacking Enviroment (bspwm, sxhkd)]]) `Hyprland` centraliza todo en un único archivo lo cual ofrece ventajas como mayor cohesión y menor dispersión de configuración, lo cual requiere acostrumbrarse a su sintais particular, que es *propietaria del compositor*.
###### Keybind declaration

En **Hyprland**, los *keybindings* se declaran con la siguiente estructura:

```ini
bind = MOD,KEY,COMMAND
```

Donde:

- `MOD`: Pyuede ser `SUPER`, `CTRL`, `ALT`, etc.
- `KEY`: Tecla a bindear, como podría ser `Q`, `Return`, `1`, etc.
- `COMMAND`: Lo que deseemos ejecutar, ya sea comando del sistema o comando interno de *Hyprland*.

