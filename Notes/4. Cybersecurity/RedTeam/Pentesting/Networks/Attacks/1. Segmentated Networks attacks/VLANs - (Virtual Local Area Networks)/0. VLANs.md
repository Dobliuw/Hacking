# Segmentated Networks

Muchas organizaciones, por lo general la mayoría, intentea mejorar la seguridad de sus redes a través de la implementación de segmentación de redes o estrategias de segregación. Estas estrategias separan activos con menor requerimiento de seguridad, como dispositivos en la red de inivitados, de componentes criticios de la infraestructura de la empresa, como los servidores web localizados en un datacenter y la red para telefonos celulares de los empleados.

---
# VLANs (Virtual Local Area Networks)

Una *VLAN* es una red lógica que agrupa un conjunto de dispositivos en una o más redes físicas, separando el tráfico de red en diferentes segmentos para mejorar la seguridad y la eficiencia de la misma, estas permiten que dispositivos que están físciamente en la misma red, pero lógicamente separados, no puedan comunicarse directamente sin pasar por un router o firewall. 

Para que dispositivos en diferentes VLANs se comuniquen, el tráfico debe pasar por un dispositivo de *Capa 3* (*Network*) del [[Modelo OSI - OSI Model]], como podría ser un router o switch. Estos dispositivos serán capaces de entender y enrutar tráfico entre distintas subredes, así como también podrán aplicar **ACLs** (**Access Control LIsts**), que son reglas que determinarán si un paquete de datos puede pasar o debe ser bloqueado.

En relación a *IoT*, estas pueden segmentar dispositivos sensibles, aislando el tráfico para evitar accesos no autorizados.

Si las *VLANs* están configuradas de forma insegura o si se utilizan protocolos de red vulnerables, un atacante podría aprovechar estas debilidades para realizar un ataque de **VLAN-Hopping**. Este tipo de ataque permite que el atacante acceda a tráfico de una VLAN diferente a la que originalmente tiene acceso, eludiendo las segmentaciones de seguridad.

![[common_vlan_network.png|1200]]

###### Access ports 

Los *Access Ports* se utilizan para conectar endpoints como computadoras, impresoras, cámaras IP, etc. a la red, cada uno de estos está configurado para pertenecer a una única VLAN. Esto sginifica que cualquier dispositivo conectado a este puerto se considera parte de esa VLAN específica.

Cuando un dispositivo envía tráfico a través de un Accesso Port, el swtich no añade etiquetas VLAN a los paquetes porque ya asume que pertenecen a la VLAN a la que está asignado el puerto. El etiqeutado solo se aplica cuando el tráfico se envía a través de un *Trunk Port*.

###### Trunk Ports

Por otro lado, los *Trunk Ports* se utilizan para transportar tráfico de múltiples VLANs entre swtiches o entre un switch y un router, a diferencia de los access ports, estos permiten que el tráfico de varias VLANs pasen por el mismo puerto.

En un Trunk Port, los paquetes se etiquetan con un *VLAN tag* que contiene el *VLAN ID*. Este etiquetado es lo que permite que el tráfico de diferentes VLANs se distinga y sea enrutado correctamente al llegar al sw tich o router de destino.

Cuando el tráfico etiquetado llega a su destino final en la red (A través de un Acces Port), el switch o router elimina la etiqueta VLAN antes de entragar el tráfico al dispositivo conectado.

###### Trunk Links & VLAN Tagging

Cuando el tráfico necesita pasar entre switches, esto se realiza a través de un *trunk link*, donde el switch añade un *VLAN tag* al pquete que incluye el *VLAN ID*. Este proceso se conoce como *VLAN Tagging*, una vez que el tráfico llega al switch de destino, el VLAN tag es eliminado y el tráfico se dirige a los puertos correctos basados en la VLAN original a la que pertenece el paquete.

###### Tráfic flow

Como vimos en la imagen de arriba, si un dispositvo (Ejemplo, *Guest laptop* de la *Room A*) envía un paquete, ese paquete solo puede ser enviado a otros dispositiovs en la VLAN a la que pertenece este (Ejemplo, *VLAN 10*), ya sea dentro del mismo switch o a través de un trunk link a otro switch.

Por otro lado, para que el tráfico pueda moverse entre diferentes VLANs, el tráfico debe pasar a través de un dispositivo de capa 3 (Como un router o un switch de capa 3) que tenga reglas configuradas para permitir o denegar dicho tráfico.

