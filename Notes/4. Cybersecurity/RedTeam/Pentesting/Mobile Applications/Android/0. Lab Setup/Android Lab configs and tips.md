# Laboratorie 

Una vez configurado nuestro setup con todas las dependencias instaladas ([[Android Lab]]) podríamos comenzar a usar el mismo para diversas funcionalidades y actividades, en nuestro caso, para el pentesting estaremos centrandonos en los módulos *Logcat*, *Terminal*, *Emulator* y *Device File Explore*. Podríamos conectar mediante USB a nuestro equipo un dispositivo Android o emularlo:

Seleccionando este apartado de aca:
![[emulator_android_lab.png|600]]

Podríamos emular diversa cantidad de celulares, tablets, televisiones y lo que deseemos, teniendo en cuenta que esta app esta originalmente pensada con fines de desarrollo de aplicaciones, las posibilidades son muchisimas.

Aquellos modelos de dispositivos que tengan el logo de la *Play Store* son aquellos que nos permitirán interactuar con la Play Store dado que esté tendrá acceso a los serivicios de Google Play. Esto significa que podremos instalar aplicaciones directamente desde la Play Store en nuestro emulador, lo caul es útil para probar aplicaciones que dependen de los servicios de Google Play.

![[android_studio_emulation.png]]

Una vez seleccionado nuestro dispositivo (Se recomienda *Nexus 5*), nos encontraremos con la sección para seleccionar nuestra **imagen**, estas son imagenes del sistema operativo Android que deseamos ejecutar para nuestro emulador, esta incluye versión de Android así como la arquitectura de CPU que utilizará.

Es importante tener en cuenta que el **API Level** es un nivel de API asociado a la versión de Android, cada versión tiene un número de nivel de API único, por ejemplo, Android 10 corresponde al nivel de API 29. Este nivel de API es importante porque define las capacidades y características del sistema operativo que nuestra aplicación podrá utilizar. Por otro lado el **ABI** (**Application Binary Interfcae**) indicá la arquitectura de la CPU que la imagen soporta.

![[system_image_android_studio.png]]

Por último simplemente seleccionaremos un nombre y alguna configuración a gusto adicional y tendremos la capacidad de emular nuestro android con un simple boton, el cual nos desplegará una pantalla con un celular el cual podrémos manejar con normalidad.

---
# ADB Shell from VM/Networked Device

Algo que podemos realizar con ADB, es exponer un socket ([[Sockets]]) para conectarnos a través de una VM o un equipo en la red para poder ejecutar comandos, o por ejemplo, conectarnos para obtener una shell el el dispositivo que esta siendo emulado.

Los comandos a ejecutar en el equipo que abrirá el socket para recibir conexiones seran:

```bash
# Kill all processes associated to adb.exe
taskkill /f /t /im adb.exe
# Open a socket on 0.0.0.0:5037
adb -a nodaemon server
```

Mientras que desde el equipo en la red o la VM desde donde nos querremos conectar (Deberá tener instalado `adb`) sera:

```bash
# Spawn a shell into de emulated device using socket opened 
adb -H {host_ip} -P 5037 shell
```

---
# Physical Device Setup

Las *developer options* u *opciones de desarrollador* en Android son un conjunto de configuraciones avanzadas que los desarrolladores pueden habilitar para probar y depurar aplicaciones y otros comportamientos del sistema operativo Android. Estas opciones proporcionan herramientas y configuracinoes que no están disponibles para el usuario promedio, facilitando tareas como el monitoreo de rendimiento, la depuración, la captura de errores y la simulación de condiciones específicas.

###### Enabling Developer Options
Para habilitar las opciones de desarrollador en un dispositivo Android lo que deberemos hacer es:

- Abrir la aplicación de *Configuración*.
- Desplazarnos hacia abajo y seleccionar *Acerca del teléfono*.
- Encontrar el *número de compilación* (Puede estar en *Información del software*).
- Tocar este número *siete veces* (Una vez hecho veremos el mensaje indicando que ahora somos desarrolladores).
- Regresar al menú principal de *configuración* y veremos una nueva opción llamada *Opciones de desarrollador* o *Developer Options*. 

Una vez hecho esto, las principales opciones de desarrollador que pueden interesarnos tanto como desarrolladores como pentesters son:

**USB Depuration**
Nos permite que nuestro dispositivo Android se comunique con una computadora a través de una conexión USB para la depuración de aplicaciones, esta opción es escencial para usar Android Debug Bridge (ADB) para instalar APKs, depurar aplicaciones y acceder a otros comandos de desarrollo.

**Logcat** (**Registro de depuración**)
Captura y muestra mensajes de registro generados por el sistema y aplicaciones. Es útil para idetnficar erroers y obtener información de estado de las aplicaciones.

**Fictitious location**
Permite simular ubicaciones GPS para probar aplicaicones que utilizan servicios de ubicación sin moverse físicamente y en cuanto al pentesting nos podría servir para evitar bloqueos por geolocalización.

**GPU profile**
Muestra gráficos de tiempo de cuadro para ayudar aidentificar problemas de rendimiento gráfico. Esto podría servirnos para lograr identificar posibles vulnerabilidades de [[Race Conditions]].

**Stay awake**
Evitar que la pantalla se apague mientras este conectado a un USB para.

