# Static Analysis

Como vimos en el apartado de [[Mobile Application Penetration Testing Process]], el análizis estático consiste en analizar la aplicación sin ejecutar la misma, únicamente análisis de código para poder detectar fallas o vulnerabilidades potenciales.

----
# Pulling an APK from Google Play Store

Para descargar aplicaciones desde Google Play Store y obtener el apk directamente desde está fuente, podríamos hacer uso del comando `adb shell` en nuestra [[Android Lab]] para obtener acceso a un dispositivo emulado, una vez en la terminal que nos permite manejar desde CLI este dispositivo, podríamos tener en mente los sigueintes comandos tras la instalación de nuestra aplicación, por ejemplo podría ser **Android Injured**.

```bash
adb shell
pm list packages
pm path {package_name}

adb pull {path} {name_to_save_apk}
``` 

----
# AndroidManifest.xml

El archivo `AndroidManifest.xml` es un componente esencial de cualquier aplicación Android. Define la estructura básica y las características de la aplicación. Este archivo se encuentra dentro del paquete APK (Android Package) y contiene información crucial que el sistema operativo Android necesita para ejecutar la aplicación correctamente.

Este describe los elementos fundamentales de la aplicación Android. Actúa como un contrato entre la aplicación y el sistema operativo Android, proporcionando información sobre la aplicación, sus componpentes y sus permisos necesarios.

Este archivo dispone de varias secciones claves:

**Package information**:
-  Define el nombre del paquete de la aplicación y la versión (**package,** **versionCode** y **versionName**).

**Application components**:
- *Activity*: Define las actividades (pantallas) de la aplicación. Cada actividad se declara con el elemento `<activity>`.
- *Service*: Declara los servicios que la aplicación utiliza. Los servicios son componentes que pueden ejecutarse en segundo plano.
- *Broadcast Receiver*: Declara los receptores de difusión, que permiten a la aplicación responder a mensajes del sistema o de otras aplicaciones.
- *Content Provider*: Declara los proveedores de contenido, que gestionan el acceso a un  conjunto estructurado de datos.

**Permissions**:
- Específica los permisos que la aplicación necesita para funcionar correctamente, como el acceso a la red, ubicación, cámara, etc, usando el elemenot `<uses-permissions>`.

**Hardware and Software features**:
- Declara los requsiitos de hardware y software de la aplicación mediante elementos como `<user-feature>` y `<uses-sdk>`.

**Intents and Filters**:
- Define las intenciones (`<intent-filters>`) que permiten que la aplicación responda a diferentes tipos de acciones y datos. Los filtros de intenciones se utilizan dentro de componentes como actividades y receptores de difusión.

**Metadata**:
- Proporciona información adicional sobre la aplicación que puede ser utilizada por el sisetma o por otras aplicaciones mediante el elemento `<meta-data>`.

*Ejemplo* básico de `AndroidManifest.xml`:

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.example.myapp"
    android:versionCode="1"
    android:versionName="1.0">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/AppTheme">
        
        <activity android:name=".MainActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
        
        <service android:name=".MyService" />
        
        <receiver android:name=".MyBroadcastReceiver">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
            </intent-filter>
        </receiver>
    </application>
</manifest>
```

En este ejemplo podemos visualizar que:

- La **Raíz** (`<manifest>`) define el paqeute y las versiones de la aplicación.
- Los **Permisos** (`<user-permission>`) decalra permisos para acceso a Internet y ubicación precisa.
- La **Aplicación** (`<application>`) contiene elementos como el icono, la etiqueta y el tema de la aplicación.
- La **Actividad** (`<activity>`) declara una actividad llamada `MainActivity` como un filtro de intención que la define como la actividad principal (*launcher*).
- El **Servicio** (`<service>`) declara un servicio llamado `MyService`.
- El **Receptor de difusión** (`<receiver>`) declara un receptor de difusión que responde a la acción `BOOT_COMPLETED`. 

Sin el archivo `AndroidManifest.xml`, el sistema operativo Android no sabría qué componentes existen en la aplicación no cóomo interactuar con ellos, a su vez, garantiza que la aplicación solicitará los permisos necesarios para funcionar correctamente, manteniendo la seguridad y privacidad del usuario, así como también definirá cómo deberá ejectuarse la aplicación, incluyendo confiraciones de temas, filtros de intenciones y metadatos específicos. Además especificará las versiones de SDK (Software Development Kit) comptaibles y las características de hardware/software necesarias, asegurando que la aplicación se ejecute en dispositivos compatibles.