# Installing Kali NetHunter Store 

La **Kali NetHunter Store** es un catalogo instalable para aplicaciones de Android orientadas a pentesting y forense, esto lo instalaremos para tener más acceso a instalar herramientas de nuestro deseo que ofrezca esta app. 

Para descargarla simplemente nos dirigimos al [sitio oficial](https://store.nethunter.com/) y presionamos el boton de *DOWNLOAD STORE APP*, lo que nos descargará un `.apk`. Desde la PC y conectado mediante USB al dispositivo (Aunque de nuevo, también se puede realizar desde este) instalamos el `.apk` como siempre:

```bash
adb install NetHunterStore.apk
```

> [!warning]  DNS via Wirless connection troubles
> En mi caso me encontre con la problemática de, estando conectado a mi proveedor de servicio de internet de manera inalámbrica, que los servidores DNS no resuelvan la dirección del dominio *store.nethunter.com* complicandome la descarga de la store y mismo, una vez logrado esto (Conectado vía ethernet en otro dispositivo) al abrir la misma desde el Pixel 6, tener que habilitar la opción de **Use Tor** para que los *mirrors* que utiliza la Store funcionen y no sean bloqueados por el ISP y traiga esos probelmas de DNS.

Una vez solucionado esto, ya pude empezara descargar herramientas que quisiera. Sin embargo.... todavía hay que instalar *Kali NetHunter Lite*, para esto nos dirigimos al GitLab de Kalilinux y dentro del apartado de nethunter nos encontraremos el repositorio de la app y sus [releases](https://gitlab.com/kalilinux/nethunter/apps/kali-nethunter-app/-/releases), en el que descargamos el `.apk` y nuevamente lo instalamos, en mi caso vía usb:

```bash
adb install nethunter-app-2019.3-rc1.apk
```

> [!warning] Installing Kali NetHunter Lite Problems
> Ahora bien, en mi caso en este punto me encontre muchisimos problemas los cuales voy a compartir a continuación. 
> 
> Como podrán ver si estan siguiendo esta guía, en este punto al entrar a la app solo tendríamos la opción *Home* y *Kali Chroot Manager* disponibles para precionar:
> 
> - **Home**: En este apartado vemos información del sistema, el cual probablemente (O al menos en mi caso) no detecte nada, má que la ip si le damos a *GET EXTERNAL IP*.
> - **Kali Chroot Manager**: Este apartado es en el que se obtiene un *estado* informátivo sobre la instalación chroot de Kali Linux (*Kali NetHunter Lite/Pro*) y la opción de agregar paquetes y eliminar el chroot o, en caso de no tenerlo instalado, la opción de *INSTALL KALI CHROOT*.
>
> *INSTALL KALI CHROOT*:
> 
> - **DOWNLOAD LATEST**: En este caso, la app de Kali NetHunter tratará de instalar el **kalifs** pero lo intentará hacer desde un mirror deprecado, por lo que no funcionará.
> - **USE SDCARD**: Esta opción, *la """utilizada"""* en mi caso (Únicamente utilizada para ir debugeando paso a paso :/ ), tratá de leer el archivo **kalifs-full.tar.xz** de la ruta `/storage/emulated/0/` para posteriormente dar a seleccionar los metapaquetes a elegir y finalmente, en mi caso, arrojar error por no encontrar una terminal (No importa que tenga instalado termux, reconocido por la NetHunter Store o instalando Kali Terminal, simpre rompió).

> [!check] Installing Kali NetHunter Lite Solution
> Sientanse libres de instalar o buscar su propia solución, en mi caso encontre el nuevo mirror utilizado por kali linux para hostear el **kalifs** en [este sitio web](https://kali.download/nethunter-images/current/rootfs/).
> 
> Una vez descargado el **kalifs** correspondiente para la arquitectura de su dispositivo, en mi caso para el *Pixel 6* y su arquitectura el `kali-nethunter-rootfs-full-arm64.tar.xz`. Ahora bien.... como mencione anteriormente, al seleccionar la opción de **USE SDCARD** en la instalación de *KALI CHROOT*, esta tratará de buscar en el path `/storage/emulated/0/` el archivo **kalifs-full.tar.xz** para descomprimirlo y montar su contenido (La raíz del sistema chroot de kali) en el directorio final `/data/local/nhsystem/` esperando el nombre `kali-armhf` y en su interior, finalmente, el contenido de toda la raíz. Por lo que deberemos pushear el comprimido descargado, pushearlo y posteriormente renombrarlo:
> 
> ```bash
> adb push kali-nethunter-rootfs-full-arm64.tar.xz /data/local/nhsystem
> adb shell
> ```
> - En la shell de android:
>   ```bash
>   su
>   cd /data/local/nhsystem
>   mv kali-nethunter-roofs-full-arm64.tar.xz kalifs-full.tar.xz
>   ```
>   
>Una vez renombrado, la solución que encontré fue, descomprimir el archivo manualmente, crear un enlace simbólico de la carpeta final `kali-arm64` a `kali-armhf` (Esto porque también me daba un error :D) y finalmente la *Kali NetHunter App* detectará el **chroot** correctamente junto a los módulos disponibles a utilizar.
>      
>- Desde *termux* ya deberíamos tener instalado la herramienta **sudo**, de no ser así (`pkg install sudo`):
>   ```bash
>   # termux on /data/local/nhsystem
>  sudo xz -d kalifs-full.tar.xz
>  sudo tar -xvf kalifs-full.tar
>   # Solve any old search
>   ln -sfn kali-arm64 kalifs
>   ln -sfn kali-arm64 kalifs-arm64
>   ln -sfn kali-arm64 kali
>   ```

Llegado este punto, felicidades, tendríamos *Kali NetHunter Instalado* correctamente, al ingresar nuevmanete a la app de Kali NetHunter deberíamos ver la información correctamente con el mensaje de `An existing Kali chroot directory was found!` en el apartado de *Kali Chroot Manager*.

> [!tip] Fixifing `/data/data/com.offsec.nhterm/files/usr/bin/kali: line 35: -c: command not found` *Kali Terminal* issue.
> 
> Este error me tiraba cada que abría *NetHunter Terminal* y la solución fue:
> 
> 1. Poner el path absoluto en el archivo `/data/data/com.offsec.nhterm/files/usr/bin/kali` del binario instalado por magisk `su` (A nivel sistema, en mi caso `/system_ext/bin/su`):
>    ```bash
>    # From termux file:
>    sudo nano /data/data/com.offsec.nhterm/files/usr/bin/kali
>    SU1=$(which su)  # -> Comment this
>    SU1="/system_ext/bin/su"
>    ```
> 2. Arreglar el entorno con montajes mínimos:
>    ```bash
>     su
>     ROOT=/data/local/nhsystem/kali-arm64
>     # Create the mount points
>     mkdir -p "$ROOT/dev" "$ROOT/proc" "$ROOT/sys" "$ROOT/dev/pts" "$ROOT/dev/shm" "$ROOT/run"
>     # mount /dev host for chroot 
>     mountpoint -q "$ROOT/dev"  || mount -o bind /dev  "$ROOT/dev"
>     # devpts for ptys
>     mountpoint -q "$ROOT/dev/pts" || mount -t devpts devpts "$ROOT/dev/pts"
>     # Proc and sysfs like in any real rootfs 
>     mountpoint -q "$ROOT/proc" || mount -t proc  proc  "$ROOT/proc"
>     mountpoint -q "$ROOT/sys"  || mount -t sysfs sysfs "$ROOT/sys"
>     # /dev/shm in tmpfs
>     mountpoint -q "$ROOT/dev/shm" || mount -t tmpfs tmpfs "$ROOT/dev/shm" -o mode=1777,nosuid,nodev
>    ```

Con esto, en mi caso particular, ya tendríamos Kali NetHunter Lite instalado correctamente junto a las funcionalidades que quisieramos realizar.

-----
# Installing NetHunter inside Termux (Alternative)

Empezaremos por actualizar los paquetes, instalar el entorno necesario y habilitar el acceso al almacenamienot (`/sdcard`):

```bash
pkg update && pkg upgrade -y
pkg install wget proot-distro
termux-setup-storage
```

Como puede fallar el script oficial por cambios en enlaces antiguos. Usaremos una [versión comunitaria](https://raw.githubusercontent.com/jorexdeveloper/termux-nethunter/main/install-nethunter.sh) más confiable:

```bash
pkg install curl -y
curl -fsSL https://raw.githubusercontent.com/jorexdeveloper/termux-nethunter/main/install-nethunter.sh -o install-nethunter-termux.sh
chmod +x install-nethunter-termux.sh
bash install-nethunter-termux.sh
```

Este script descargará e instalará automáticamente el sistema de archivos de Kali dentro del chroot. Una vez ejecutado correctamente, tendremos en nuestro sistema *Kali NetHunter Lite*, por lo que al ejecutar el comando `nh` o `nethunter` desplegaremos la **CLI del chroot**.

En caso de querer tener una **GUI** habría que instalar la [app oficila de NetHunter](https://gitlab.com/kalilinux/nethunter/apps/kali-nethunter-app/-/releases), darle permisi de root y esta nos habilitará a:

- Lanzar NetHunter CLI o GUI.
- Administrar servicios (ssh, vnc, web).
- Actualizar chroot.

Mediante el usb conectado a nuestro dispositivo desde la PC (O accediendo y descargando la `.apk`desde nuestro dispositivo)
```bash
adb install nethunter-app-2019.3-rc1.apk
```

> [!warning]  Esto nos arrojará una ventana que nos indicará que la aplicación trata de bypassear algunas medidas de seguridad, en este punto deberemos indicar **Install anyway**.

Luego de la instalación exitosa, entraremos a la aplicación y le brindaremos los correspondientes permisos de root tras que la mismas los solicite.

https://store.nethunter.com/NetHunterStore.apk