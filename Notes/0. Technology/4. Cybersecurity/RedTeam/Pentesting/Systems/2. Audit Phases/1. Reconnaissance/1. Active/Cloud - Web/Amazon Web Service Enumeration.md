-----
- Tags: #teoria #practica #reconocimiento 
-----

# Amazon Web Service (AWS)

**Amazon Web Service (AWS)** es la nube más adopata y completa en el mundo. Los servicios de AWS ofrecen soluciones escalables para la computación, el almacenamiento, las bases de datos, el análisis y mucho más. 

----

# Enumeración 

Muchas veces de cara a una auditoría puede ser que nos encontremos con servicios de AWS, en el mejor de los casos podríamos llegar a dar con la **Access Key ID**, la **Secret Access Key** y la **region**. En caso de contar con dichas configuraciones, podríamos hacer uso de herramientas como [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) y configurar estos valores para posteriormente realizar llamadas al servidor de AWS.

#### Instalar AWS-CLI
```bash
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

# Creating a default profile / Profile 

Una vez instalada la herramienta, la podríamos usar para hacer peticiones a nuestro servidor de AWS, pero previo a eso, deberemos llevar a cabo una configuración de nuestro perfil o crear y configurtar uno.

- Configurar perfil por defecto.

```bash
aws configure 
```

- Crear y configurar un perfil asociado a un identificador.

```bash
aws configure --profile dobliuw_profile
```

Ambos outputs nos pediran los valores:

```bash
# AWS Access Key ID : {Acces_Key_ID}
# AWS Secret Access Key : {Secret_Acces_key}
# Default region name : {region}
# Default output format : json
```

# Lambda Enumeration

Una vez realizada las configuraciones, podríamos intentar reconocer esto mismo, por ejemplo, si estuvieramos enfrentandonos a **funciones lambda** podríamos hacer uso del panel de ayuda de esta herramienta para entender como podríamos llegar a listar y ver funciones lambda.

```bash
aws help
aws lambda help 

aws --endpoint-url={aws_url} lambda list-functions # Listar funciones lambda del servidor AWS
aws --endpoint-url={aws_url} lambda get-function --function-name "{function_name}" # Listar información de una determinada función lambda
```

De esta manera, al listar la información de las funciones lambda, podríamos obtener una url con el codigo para descargarlo y analizarlo. 

# Buckets (s3) Enumeration

En caso de tener un ednpoint *s3 api* (IP o URL) podríamos usar el comando:

```bash
aws --profile {profile} --endpoint-url http://{IP_HOST}:{PORT} s3api list-buckets
```

Una vez listados los *Buckets*, podremos interactuar con los los objetos de un bucket con los siguientes comandos:

```bash
# List
aws --profile {profile} --endpoint-url http://{IP_HOST}:{PORT} s3 ls s3://{BUCKET}/

# Download
aws --profile {profile} --endpoint-url http://{IP_HOST}:{PORT} s3 cp s3://{BUCKET}/paht/object.bin ./system/path

# Sync
aws --profile {profile} --enpoint-url http://{IP_HOST}:{PORT} s3 sync s3://{BUCKET}/prefix ./system/path
```

> [!warning] TLS Error
> Si utilizamos `https://{IP}`es común que en algunas ocaciones obtengamos un error por SNI/Cert. Por lo que agregar la flag...
> 
> ```bash
> --no-verify-ssl
> ```
> 
> ...es una buena idea probar.
> ##### Otro punto es el error de *Signature*.
> 
> Con endpoints no-AWS o AWS 'especiales', a veces necesitaremos fijar:
> 
> - Signature v4.
> - Addressing stryle.
> - Region.
>   
>   Crear o editar para posteriormente repetir los anteriores comandos el archuivo de configuración `~/.aws/config`:
> 
> ```bash
> [profile s3target]
> region = {region}
> s3 =
> 	addressing_style = path
> 	 signature_version = s3v4



