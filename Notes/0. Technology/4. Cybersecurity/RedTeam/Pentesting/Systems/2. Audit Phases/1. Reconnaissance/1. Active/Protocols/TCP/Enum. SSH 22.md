# SSH (Secure Shell)

**SSH** (Secure Shell) es un protocolo de red que permite la conexión remota segura entre dos ordenadores, cifrando la comunicaación para autenticar usuarios y trnasferir datos de forma segura, funcionando como reemplazo más seguro para protocolos antiguos como lo era *Telnet*.

----
Keys in SSH

La autenticación sin contraseña en SSH se logra mediante el uso de pares de claves SSH (*Public* and *Private* Key). Esto mejora la seguridad y conveniencia al eliminar la necesidad de ingresar una contraseña cada vez que se realizar una conexión SSH.

- *Public Key* (**id_rsa.pub**): La clave pública se comparte con el servidor para qeu pueda autenticar al usuario.
- *Private Key* (**id_rsa**): La clave privada se mantiene segura y nunca se comparte. Es usada para autenticar al usuario al servidor.

Para habilitar el demonio de SSH, podemos hacer uso de la herramienta `systemctl` o `service`:

```bash
sudo systemctl start sshd
sudo service sshd start

sudo systemctl enable sshd
```

Una vez habilitado el demonio de SSH, es importante destacar que en este punto otros equipos podrían conectarse de manera remota a mi sistema obteniendo una *Secure Shell* en caso de proporcionar un usuario y contraseña válidos, pero para que no haya que ingresar credenciales, primero podriamos proseguir con la creación de nuestro par de claves SSH:

```bash
ssh-keygen
```

###### Using the public key
Una vez creada las claves SSH, estas se encontraran en el directorio oculto `.ssh` del usuario. En donde, a su vez, deberemos crear el archivo **authorized_keys** donde almacenaremos la clave pública del equipo que queremos permitir que autentique sin proporcionar credenciales:

```bash
# Create authorized_keys file
touch ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys
# Copy public key to this file (Way 1)
cat ~/.ssh/id_rsa.pub | ssh {username}@{ip} 'cat >> ~/.ssh/authorized_keys'
# Way 2
ssh-copy-id -i ~/.ssh/id_rsa.pub {username}@{ip}
```

###### Using the private key
En caso de disponer desde otros equipos de la clave privada del usuario, podremos utilizar la misma para contectarnos sin proporcionar contraseña como archivo de indentificación:

```bash
ssh -i /path/to/id_rsa {user}@{ip}
```

-----
# Recover id_xxx.pub from Private Key

Algo que podemos hacer es recuperar la *clave pública* a partir de la privada, siempre que la privada esté intacta y si está cifrada, sea sin password.

```bash
ssh-keygen -y -f {private_key} > id_xxx.pub
```

De esta manera podríamos obtener información relevante como el nombre de usuario asociado a la clave privada, en caso de que no sepamos cual.

> [!warning] Error asking passphrase?
> En caso de ejecutar el comando previamente compartido y obtener la solicitud de ingresar una contraseña, estamos ante un problema. La clave esta cifrada con contraseña, por lo que necesitaremos la misma.... o tratar de crackearla.
> 
> ```bash
> ssh2john id_xxx.pub > hash.txt
> john --format=ssh hash.txt -w /usr/share/wordlist/dobliuw.txt
> ```
