# Plugin loader 

En este punto utilizaremos un proyecto llamado [lazy nvim]( https://github.com/folke/lazy.nvim) para llevar a cabo la gestion de plugins en nuestro entorno de nvim, por lo que en primer lugar deberemos instalar las dependencias que necesitarÃ¡ este gestor de plugins. 

En primer lugar, haremos uso del lenguaje de programaciÃ³n `lua` asÃ­ como del gestor de paquetes [luarocks](https://luarocks.org/) que `Lazy Nvim` podrÃ¡ utilizar en determinadas ocaciones. Para llevar a cabo la instalaciÃ³n de esto haremos uso de la [guÃ­a de instalaciÃ³n](https://github.com/luarocks/luarocks/blob/main/docs/index.md) o uso de la herramienta **Scoop** para la instalaciÃ³n automÃ¡tica de estas dos dependencias:

- Descarga de **Scoop**:

```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
irm get.scoop.sh | iex
```

En este punto cerrariamos y volveriamos a abrir la terminal y hariamos uso de **Scoop** para llevar a cabo la instalaciÃ³n:

```powershell
scoop install git
scoop install lua
scoop install luarocks
```

Validar si las dependencias estÃ¡n correctamente instaladas:

```bash
git -v
lua -v
luarocks --version
```
#### Install Lazy.nvim

Ahora si, una vez instaladas las dependencias, saltariamos a la instalaciÃ³n del gestor de plugins de Nvim **Lazy Nvim** segÃºn su [guÃ­a de instalaciÃ³n](https://lazy.folke.io/installation), para esto deberÃ­amos crear una estructura de directorios en el directorio de configuraciÃ³n inicial (Se puede ver con el comando `:echo stdpath("config")`).

```powershell
cd $env:LOCALAPPDATA\nvim
echo require("config.lazy") > init.lua
mkdir config
cd config & notepad lazy.lua
```

A continuaciÃ³n basandonos en la guÃ­a procederemos con el contenido del archivo `lazy.lua`:

- `lazy.lua`: 
```lua
-- Bootstrap lazy.nvim
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim" -- In windows %LOCALAPPDATA%\nvim-data\lazy\lazy.nvim
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  local lazyrepo = "https://github.com/folke/lazy.nvim.git" -- Repository to clone the lazy plugin manager
  local out = vim.fn.system({ "git", "clone", lazyrepo, lazypath }) 
  -- git clone https://github.com/folke/lazy.nvim.git $env:LOCALAPPDATA\nvim-data\lazy\lazy.nvim
  if vim.v.shell_error ~= 0 then
    vim.api.nvim_echo({
      { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
      { out, "WarningMsg" },
      { "\nPress any key to exit..." },
    }, true, {})
    vim.fn.getchar()
    os.exit(1)
  end
end

-- Add Lazy.nvim to runtimepath
vim.opt.rtp:prepend(lazypath)

-- Make sure to setup `mapleader` and `maplocalleader` before
-- loading lazy.nvim so that mappings are correct.
-- This is also a good place to setup other settings (vim.opt)
vim.g.mapleader = " "
vim.g.maplocalleader = "\\"

-- Setup lazy.nvim
require("lazy").setup({
  spec = {
    -- Here the Lua files will be imported and return plugin definitions.
    { import = "plugins" },
  },
  -- ###### Any other settings here #######
  -- colorscheme that will be used when installing plugins.
  install = { colorscheme = { "habamax" } },
  -- automatically check for plugin updates
  checker = { enabled = true },
})
```

Este script valida si existe el repositorio lazy.nvim clonado, de lo contrario intenta hacerlo. En caso de arrojar error:

```powershell
git clone "https://github.com/folke/lazy.nvim.git" $env:LOCALAPPDATA\nvim-data\lazy\lazy.nvim
```

A partir de aca, como se puede visualizar en la lÃ­nea...

```lua
-- ...............
require("lazy").setup({
  spec = {
    -- import your plugins
    { import = "plugins" },
  },
})
-- ...............
```

DeberÃ­amos crear un directorio `plugins` para dentro ir ingresando los plugins `.lua` a gusto:

```lua
ðŸ“‚ nvim-config/
â”œâ”€â”€ init.lua                --> Entrypoint
â”œâ”€â”€ lua/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ init.lua        --> importa opciones, keymaps, lazy
â”‚   â”‚   â”œâ”€â”€ options.lua     --> vim.opt.*
â”‚   â”‚   â”œâ”€â”€ remap.lua       --> keymaps
â”‚   â”‚   â””â”€â”€ lazy.lua        --> bootstrap de lazy
â”‚   â””â”€â”€ plugins/
â”‚       â”œâ”€â”€ ui.lua          --> tokyonight, lualine, etc
â”‚       â”œâ”€â”€ coding.lua      --> treesitter, autopairs, etc
â”‚       â””â”€â”€ lsp.lua         --> mason, lspconfig, cmp
â”‚       â””â”€â”€ dobliuw.lua     --> custom plugins
```