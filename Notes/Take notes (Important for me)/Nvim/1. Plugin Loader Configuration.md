[# Plugin loader 

En este punto utilizaremos un proyecto llamado [lazy nvim]( https://github.com/folke/lazy.nvim) para llevar a cabo la gestion de plugins en nuestro entorno de nvim, por lo que en primer lugar deberemos instalar las dependencias que necesitar√° este gestor de plugins. 

En primer lugar, haremos uso del lenguaje de programaci√≥n `lua` as√≠ como del gestor de paquetes [luarocks](https://luarocks.org/) que `Lazy Nvim` podr√° utilizar en determinadas ocaciones. Para llevar a cabo la instalaci√≥n de esto haremos uso de la [gu√≠a de instalaci√≥n](https://github.com/luarocks/luarocks/blob/main/docs/index.md) o uso de la herramienta **Scoop** para la instalaci√≥n autom√°tica de estas dos dependencias:

- Descarga de **Scoop**:

```powershell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
irm get.scoop.sh | iex
```

En este punto cerrariamos y volveriamos a abrir la terminal y hariamos uso de **Scoop** para llevar a cabo la instalaci√≥n:

```powershell
scoop install git
scoop install lua
scoop install luarocks
```

Validar si las dependencias est√°n correctamente instaladas:

```bash
git -v
lua -v
luarocks --version
```
#### Install Lazy.nvim

Ahora si, una vez instaladas las dependencias, saltariamos a la instalaci√≥n del gestor de plugins de Nvim **Lazy Nvim** seg√∫n su [gu√≠a de instalaci√≥n](https://lazy.folke.io/installation), para esto deber√≠amos crear una estructura de directorios en el directorio de configuraci√≥n inicial (Se puede ver con el comando `:echo stdpath("config")`).

```powershell
cd $env:LOCALAPPDATA\nvim
echo require("config.lazy") > init.lua
mkdir config
cd config & notepad lazy.lua
```

A continuaci√≥n basandonos en la gu√≠a procederemos con el contenido del archivo `lazy.lua`:

- `lazy.lua`: 
```lua
-- Bootstrap lazy.nvim
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim" -- In windows %LOCALAPPDATA%\nvim-data\lazy\lazy.nvim
if not (vim.uv or vim.loop).fs_stat(lazypath) then
  local lazyrepo = "https://github.com/folke/lazy.nvim.git" -- Repository to clone the lazy plugin manager
  local out = vim.fn.system({ "git", "clone", lazyrepo, lazypath }) 
  -- git clone https://github.com/folke/lazy.nvim.git $env:LOCALAPPDATA\nvim-data\lazy\lazy.nvim
  if vim.v.shell_error ~= 0 then
    vim.api.nvim_echo({
      { "Failed to clone lazy.nvim:\n", "ErrorMsg" },
      { out, "WarningMsg" },
      { "\nPress any key to exit..." },
    }, true, {})
    vim.fn.getchar()
    os.exit(1)
  end
end

-- Add Lazy.nvim to runtimepath
vim.opt.rtp:prepend(lazypath)

-- Make sure to setup `mapleader` and `maplocalleader` before
-- loading lazy.nvim so that mappings are correct.
-- This is also a good place to setup other settings (vim.opt)
vim.g.mapleader = " "
vim.g.maplocalleader = "\\"

-- Setup lazy.nvim
require("lazy").setup({
  spec = {
    -- Here the Lua files will be imported and return plugin definitions.
    { import = "plugins" },
  },
  -- ###### Any other settings here #######
  -- colorscheme that will be used when installing plugins.
  install = { colorscheme = { "habamax" } },
  -- automatically check for plugin updates
  checker = { enabled = true },
})
```

Este script valida si existe el repositorio lazy.nvim clonado, de lo contrario intenta hacerlo. En caso de arrojar error:

```powershell
git clone "https://github.com/folke/lazy.nvim.git" $env:LOCALAPPDATA\nvim-data\lazy\lazy.nvim
```

A partir de aca, como se puede visualizar en la l√≠nea...

```lua
-- ...............
require("lazy").setup({
  spec = {
    -- import your plugins
    { import = "plugins" },
  },
})
-- ...............
```

Deber√≠amos crear un directorio `plugins` para dentro ir ingresando los plugins `.lua` a gusto:

```lua
üìÇ nvim-config/
‚îú‚îÄ‚îÄ init.lua                --> Entrypoint
‚îú‚îÄ‚îÄ lua/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ init.lua        --> importa opciones, keymaps, lazy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ options.lua     --> vim.opt.*
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ remap.lua       --> keymaps
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lazy.lua        --> bootstrap de lazy
‚îÇ   ‚îî‚îÄ‚îÄ plugins/
‚îÇ       ‚îú‚îÄ‚îÄ ui.lua          --> tokyonight, lualine, etc
‚îÇ       ‚îú‚îÄ‚îÄ coding.lua      --> treesitter, autopairs, etc
‚îÇ       ‚îî‚îÄ‚îÄ lsp.lua         --> mason, lspconfig, cmp
‚îÇ       ‚îî‚îÄ‚îÄ dobliuw.lua     --> custom plugins
```

----
# Basic Plugins

Una vez creada la base de configuraci√≥n modular y preparado el entorno para gestionar plugins con [lazy.nvim](https://github.com/folke/lazy.nvim), hemos en el archivo *lazy.lua* indicado que importariamos plugins desde el directorio `plugins`, pero no hemos detallado cu√°les. A cotninuaci√≥n, algunos de los plugins *esenciales*, *populares* y *funcionales*.

> [!info] Plugins 
> A la hora de instalar plugins, podremos crear archivos `.lua` dentro de nuestra carpeta de plugins en la cual indicar una configuraci√≥n b√°sica como la que se dar√° de ejemplo la cual le indica a `lazy.nvim`que repositorios de plugins clonar cuando estos archivos son cargados. Todos los **plugins descargados** ser√°n encontrados en `~/.local/share/nvim/lazy`.
> 
> Por ejemplo, cuando querramos agregar plugins para nuestro apartado de **UI y Est√©tica**, podr√≠amos crear el archivo **ui.lua** en el cual agregar las correspondientes configuraciones de los plugins a agregar, por ejemplo auqells que gestionen t√©mas, barras de estado, etc.
##### UI / Aesthetics

- [Tokyonight.nvim](https://github.com/folke/tokyonight.nvim):
	- Tema de colores oscuro estilo *Tokyo Night* (Inspirado en VSCode) muy personalizable.
	- Proporciona un tema agradable, compatible con *Treesitter*, *LSP* y otros.
- Configuraci√≥n dentro de `plugins/ui.lua`:
```lua
return {
  {
    "folke/tokyonight.nvim",
    lazy = false,
    priority = 1000,
    opts = {}
  }
}
```

- [Lualine.nvim](https://github.cm/nvim-lualine/lualine.nvim):
	- Barra de estado altamenta configurable para Neovim.
	- Muestro modo actual, nombre de archivo, errors de LSP, encoding, etc.
- Configuraci√≥n:
```lua
return {
  "nvim-lualine/lualine.nvim",
  dependencies = { "nvim-tree/nvim-web-devicons" },
  config = function()
    require("lualine").setup {
      options = { theme = "tokyonight" }
    }
  end
}
```

##### Code Intelligence

- [Nvim-treesitter](https://github.com/nvim-treesitter/nvim-treesitter):
	- Parser basado en √Årboles de Sintaxis Abstrakta (AST) para highlighting, folding, indentado, etc.
	- Highlighting y an√°lisis sint√°ctico avanzado. Funciona como base para plugins como *textobjects*, *refactoring* y *playground*.
- Configuraci√≥n b√°sica:
```lua
{
  "nvim-treesitter/nvim-treesitter",
  build = ":TSUpdate",
  config = function()
    require("nvim-treesitter.configs").setup({
      ensure_installed = { "lua", "bash", "python", "c", "vim", "json" },
      highlight = { enable = true },
      indent = { enable = true },
    })
  end
}
```

##### Autompleting and LSP (Language Server Protocol)

**LSP** es un protocolo est√°ndar desarrollado por Microsoft que permite que los editoes de texto se comuniquen con *servidores de lenguaje* (Como `pyright`para Python, `clangd`para C/C++, etc.) Estos servidores ofrecen funcionalidades como:

- Autocmpletado inteligente.
- Ir a definici√≥n / referencias.
- Diagn√≥sticoos de errores / warnings.
- Documentaci√≥n flotante (*hover*).
- Refactorizaciones, renombrado, etc.

El **cliente LSP** de Neovim se encarga de conectarse a estos sercidores. Para facilitar suy gesti√≥n y configuraci√≥n se pueden utilizar distintos pugins.

 - [Mason.nvim](https://github.com/williambooman/mason.nvim) + [Nvim-lspconfig](https://github.com/neovim/nvim-lspconfig)
	 - `mason.nvim`: Instalador de servidores *LSP*, *DAPs* y herramientas externas.
	 - `lspconfig`: Configurador nativo de clientes LSP para lenguajes (Pyright, tsserver, etc).
	 - A√±ade *IntelliSense*, *Jump-to-definition*, *diagnostics*.
 - Configuraci√≥n m√≠nima:
```lua
{
  "williamboman/mason.nvim",
  config = function()
    require("mason").setup()
  end
},
{
  "neovim/nvim-lspconfig",
  config = function()
    local lspconfig = require("lspconfig")
    lspconfig.lua_ls.setup {}
  end
}
```

##### Code quality

- [Nvim-autopairs](https://github.com/windwp/nvim-autopairs)
	- Autocompleta pares de par√©ntesis, llaves, comillas, etc.
	- Mejora la edici√≥n de c√≥digo con comportamiento contextual inteligente.
- Configuraci√≥n:
```lua
{
  "windwp/nvim-autopairs",
  event = "InsertEnter",
  config = function()
    require("nvim-autopairs").setup()
  end
}
```

##### Debug & Testing

- [Nvim-dap](https://github.com/mfussenegger/nvim-dap)
	- Proporciona integraci√≥n de debugging estilo Visual Studio Code dentro de Neovim.
	- Se configura por lenguaje, usando adaptadores DAP. Ideal para debugging en Lua, Python, etc.