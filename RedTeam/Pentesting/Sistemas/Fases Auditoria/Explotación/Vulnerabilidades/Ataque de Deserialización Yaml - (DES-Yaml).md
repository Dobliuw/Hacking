----
- Tags: #ataques #teoria #practica #basico 
----

# ¿ Que es un **Ataque de Deserialización Yaml** ? 

### Un **ataque de Deserialización Yaml (DES-Yaml)** es un tipo de vulnerabilidad que puede ocurrir en aplicaciones Python que usan **YAML (Yet Another Markup Language)** para serializar y deserializar objetos. 

### La vulnerabilidad se produce cuando un atacantes es capaz de controlar la entrada YAML que se pasa a una función de deserialización en la aplicación. Si el código de la aplicación no valida adecuadamente la entrada YAML, puede permitir que un atacante inyecte código malicioso en el objeto deserializado. 

### Una vez el objeto ha sido deserializado, el código malicioso puede ser ejecutado en el contexto de la aplicación, lo que puede permitir al atacante tomar control del sistema, acceder a datos sensibles, o incluso ejecutar código remoto. 

### Lo atacantes pueden aprovecharse de las vulnerabilidades de DES-Yaml para realizar ataques de denegación de servicio (DoS), inyectar código malicioso, o incluso tomar el control completo del sistema. 

### El impacto de un **Ataque de deserialización Yaml** depende del tipo y la sensibilidad de los datos que se pueden obtener, pero puede ser muy grave. por lo tanto, es importante que los desarrolladores de aplicaciones Python validen y filtren adecuadamente la entrada YAML que se pasa a las funciones de deserialización, y que utilicen técnicas de seguridad como la limitación de recursos para prevenir ataques DoS y la desactivación de la deserialización automática de objetos no confiables. 

---- 

# Explotación 

### Para explotar un ataque de deserialización cuando reconocemos que esta yaml corriendo por detrás, es importante que, como siempre, hay que tener en cuenta en caso, esto puede ser muy fácil así como difícil dependiendo la sanitización de la aplicación web, entre otros factores. 
### Existen páginas como [esta](https://www.pkmurphy.com.au/isityaml/) en las cuales enseñan como se podría llegar a ejecutar comandos a través de un ataque de deserialización.  

### Por ejemplo, si tenemos una aplicación la cual corre python y vemos que se nos redirige a una url tal que así: 

#### ..../eWFtbDogVGhlIGluZm9ybWF0aW9uIHBhZ2UgaXMgc3RpbGwgdW5kZXIgY29uc3RydWN0aW9uLCB1cGRhdGVzIGNvbWluZyBzb29uIQ==

### Podemos intuir que es una cadena en base64, por lo que si la decodeamos: 

```bash
echo -n "eWFtbDogVGhlIGluZm9ybWF0aW9uIHBhZ2UgaXMgc3RpbGwgdW5kZXIgY29uc3RydWN0aW9uLCB1cGRhdGVzIGNvbWluZyBzb29uIQ==" | base64 -d; echo
```

### Veríamos el output: `yaml: The information page is still under construction, updates coming soon!`, intuyendo así que por detrás corre YAML. Usando la página previamente mencionada veríamos que para intentar ejecutar comandos en un aplicativo que deserializa información yaml sin validaciones con el payload `!!python/object/apply:subprocess.check_output ['<command_to_execute>']`.

### Pudiendo así ejecutar comandos a través de la explotación de la deserialización YAML en python haciendo lo siguiente: 

```bash
echo -n "yaml: !!python/object/apply:subprocess.check_output ['id']" | base64 -w 0; echo 
```

### Y pegando la cadena de base64 como URL para así lograr la ejecución de comandos. 

